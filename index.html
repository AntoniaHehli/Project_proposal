<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Laura Haus and Antonia Hehli">
<meta name="dcterms.date" content="2023-07-02">

<title>Calculation of carbon dioxide emissions from movement trajectories</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-and-methods" id="toc-data-and-methods" class="nav-link" data-scroll-target="#data-and-methods">Data and Methods</a>
  <ul class="collapse">
  <li><a href="#data-set" id="toc-data-set" class="nav-link" data-scroll-target="#data-set">Data Set</a></li>
  <li><a href="#pre-processing" id="toc-pre-processing" class="nav-link" data-scroll-target="#pre-processing">Pre-Processing</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#simple-scenario" id="toc-simple-scenario" class="nav-link" data-scroll-target="#simple-scenario">Simple scenario</a></li>
  <li><a href="#speed-scenario" id="toc-speed-scenario" class="nav-link" data-scroll-target="#speed-scenario">Speed scenario</a></li>
  <li><a href="#slope-scenario" id="toc-slope-scenario" class="nav-link" data-scroll-target="#slope-scenario">Slope scenario</a></li>
  <li><a href="#comparison-of-all-three-scenarios" id="toc-comparison-of-all-three-scenarios" class="nav-link" data-scroll-target="#comparison-of-all-three-scenarios">Comparison of all three scenarios</a></li>
  <li><a href="#comparison-posmo-emission-calculations-and-our-calculations" id="toc-comparison-posmo-emission-calculations-and-our-calculations" class="nav-link" data-scroll-target="#comparison-posmo-emission-calculations-and-our-calculations">Comparison Posmo emission calculations and our calculations</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  <li><a href="#outlook" id="toc-outlook" class="nav-link" data-scroll-target="#outlook">Outlook</a></li>
  <li><a href="#sources" id="toc-sources" class="nav-link" data-scroll-target="#sources">Sources</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#literature" id="toc-literature" class="nav-link" data-scroll-target="#literature">Literature</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Calculation of carbon dioxide emissions from movement trajectories</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">GEO880 - Computational Movment Analysis (UZH) / Patterns and Trends in Environmental Data (ZHAW)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Laura Haus and Antonia Hehli </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 2, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminaries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Import libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readr"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"raster"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"terra"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>Mobility is an important source for carbon dioxide emission whereas road transportation is responsible for around 20 percent of global carbon dioxide emissions. Using movement data from Posmo we determined the emissions based on approaches with increasing complexities. Thereby we used 3 different validated data sets. There are significant differences in the calculations of carbon emissions depending on the complexity of the approach. In our assessement an increased complexity lead to decreased emissions. Our study revealed that the calculation of emissions depends on many variables and factors which are difficult to include in a holistic analysis.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Road transportation is responsible for around 20 percent of global carbon dioxide emission whereof almost half of these emissions are caused by passenger road vehicles (Suarez et al., 2022). Due to the strongly negative impact of carbon dioxide emissions on climate change, they world widely receive gradually increasing concern (Dong et al., 2022). Driving behavior like acceleration as well as terrain characteristics such as an incline have valid impacts on carbon dioxide emissions (Dong et al., 2022; Suarez et al., 2022; Xu et al., 2022). However, road traffic is not the only type of traffic that causes carbon dioxide emissions. Trains, trams, and – when also taking production emissions into account – even bicycles cause carbon dioxide emissions. Therefore, we will also take these transportation modes into account. In this project, we analyze carbon dioxide emissions by different transportation types using different complexity levels as well as emission scenarios and compare these different setups with each other. We use validated movement data collected by the Posmo app from 3 students of the course Computational Movement Analysis in Spring 2023 at ZHAW. The objective of this report is to determine the weekly average emissions per person for each transportation mode. Thereby, we additionally want to analyse how much the complexity of an approach changes the results for carbon emissions calculations. Furthermore, we compare the results of our calculation with the emissions provided by Posmo and assess the differences for each transportation mode.</p>
</section>
<section id="data-and-methods" class="level1">
<h1>Data and Methods</h1>
<section id="data-set" class="level2">
<h2 class="anchored" data-anchor-id="data-set">Data Set</h2>
<p>For the analysis of the emissions, we included Posmo data from a data pool provided in the course. As the exact used transportation mode is crucial in our assessment we only included data sets which were validated, which reduced the included data sets to three. Finally, our data set includes 111’253 data points with the following attributes: - user_id - datetime - weekday - transport_mode - lon_x - lat_y The Posmo data has different temporal time spans for the different people. Data set 1 spans from April 1<sup>st</sup> to May 11<sup>th</sup> 2023, data set 2 from April 6<sup>th</sup> to June 11<sup>th</sup> and data set 3 from April 11<sup>th</sup> to June 16<sup>th</sup> 2023. The temporal resolution of our tracking data varies between 5 and 15 seconds.</p>
</section>
<section id="pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="pre-processing">Pre-Processing</h2>
<p>Pre-processing was needed to be able to use our data set for the further analysis. We decided to reduce our assessment area to Switzerland. First, our emission data is mostly based on Swiss and German data and differences in emissions in other countries are possible. Second, we included a slope analysis which would have been too expensive to calculate for multiple countries. The outlines of Switzerland were pre-processed using QGIS. We only included transportation modes which generate carbon dioxide emissions. We do not include airplanes in our considerations as we are only going to focus on trajectories in Switzerland. Finally, we included in our analysis car, bus, train, tram as well as e-bikes and bikes as they produce carbon emissions when taking the production process into account. Additionally, we removed all static points as we are interested in the emissions of moving vehicles. We thereby considered a threshold of 215m. The average velocity of a bicycle is 12.8 km/h (BFS &amp; ARE, 2023). With an assumed average tracking cycle of 10 seconds this would correspond with a distance of around 215 meters which a bicycle could drive in 60 seconds (moving window includes 6 time stamps). We filtered velocities which exceeded 200 km/h, which is the highest velocities some InterCity trains in Switzerland travel (Knupfer, 2014). We also set the minimum speed to 10 as this corresponds with the average velocity of our slowest transportation mode, bicycle.<br>
Furthermore, we excluded all slopes which are steeper than 25%, which corresponds to 14.4° as the steepest mountain pass slope in Switzerland is around this value (Wikipedia, 2022).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to load the posmo data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>loadPosmoData <span class="ot">&lt;-</span> <span class="cf">function</span>(filepath){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_delim</span>(filepath, <span class="at">delim =</span> <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove the place name</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(place_name)) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove NA values for transport mode, we need a specified transport mode</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(transport_mode))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># load all validated Posmo track files</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>posmo1 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_1.csv"</span>) <span class="co"># our own data</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>posmo2 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_2.csv"</span>) <span class="co"># our own data</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>posmo3 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_3.csv"</span>) <span class="co"># Posmo data tracking pool</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">full_join</span>(posmo1, posmo2)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">full_join</span>(posmo, posmo3)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># remove rows with NA in the coordinates</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo[<span class="sc">!</span><span class="fu">is.na</span>(posmo<span class="sc">$</span>lon_x), ]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf object and transform to LV95</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># extract coordinates</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>posmo_coord <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(posmo)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create one dataframe</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">cbind</span>(posmo, posmo_coord)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># read Switzerland and the cantons</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>CH_boundaries <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/swissboundaries3D/CH_boundaries.gpkg"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>CH_cantons <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/swissboundaries3D/CH_cantons.gpkg"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># filter points that are within Switzerland</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">st_filter</span>(posmo, CH_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it worked</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> transport_mode), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Posmo tracks in Switzerland"</span>) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Transport Mode"</span>))<span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-firstFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-firstFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: All posmo tracks from the three data set, colored by transport mode.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get all the transportation modes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(posmo<span class="sc">$</span>transport_mode)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save transportation modes we need in a vector</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>transport_modes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Car"</span>, <span class="st">"Bus"</span>, <span class="st">"Train"</span>, <span class="st">"Tram"</span>, <span class="st">"Bike"</span>, <span class="st">"E_Bike"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to only the transportation modes we need</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">%in%</span> transport_modes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># functions to determine moving window</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>movingWindowLag <span class="ot">&lt;-</span> <span class="cf">function</span>(E, N, n){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((<span class="fu">lag</span>(E, n) <span class="sc">-</span> E)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">lag</span>(N, n) <span class="sc">-</span> N)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>movingWindowLead <span class="ot">&lt;-</span> <span class="cf">function</span>(E, N, n){</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((E <span class="sc">-</span> <span class="fu">lead</span>(E, n))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (N <span class="sc">-</span> <span class="fu">lead</span>(N, n))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate moving window</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus3 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">3</span>),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus2 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">2</span>),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus1 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">1</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus1 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">1</span>),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus2 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">2</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus3 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">3</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean step length</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(minus3, minus2, minus1, plus1, plus2, plus3))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># define a column 'static'</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">static =</span> stepMean <span class="sc">&lt;</span> <span class="dv">215</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot whether trajectories are static or not</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>posmo <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(X,Y)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> static)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Static and non-static points in the trajectories"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Static"</span>)<span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># remove static points</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>static)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-secondFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-secondFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Static and non-static parts of the Posmo trajectories.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read the raster data using the terra package</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dhm25 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/DHM25/dhm25_grid_raster.asc"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set the raster crs to LV03</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(dhm25) <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crs</span>(<span class="st">"+init=EPSG:21781"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert Posmo data to LV03 to match the CRS of the DHM25</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>posmo_lv03 <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">21781</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(X, Y))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the height information for each Posmo location</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>height_dhm <span class="ot">&lt;-</span> <span class="fu">extract</span>(dhm25, posmo_lv03)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># join the height back to the posmo data</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>posmo<span class="sc">$</span>height <span class="ot">&lt;-</span> height_dhm<span class="sc">$</span>dhm25_grid_raster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>To calculate the emissions we first had to determine values for the carbon dioxide emissions for the considered transportation means. As they strongly vary depending on the sources we included multiple values for some of the transportation modes. To calculate our weekly emission we determined the average value of the collected emission values for each transportation mode and multiplied it with the distance. As the time period when people collected Posmo data does not correspond we needed to normalize the emission values for each person to determine the 7-days average. In order to determine the influence of the complexity of an approach we also considered other factors such as the effect of velocity or slope on the carbon emissions. These additional factors were only calculated and compared for the emissions of cars as this is the transportat mode that each can control a lot themselves when driving as compared to when travelling in a train or bus for example.</p>
<p><strong>Speed</strong></p>
<p>Information about the change in car emission for velocities between 100 and 130 km/h were provided by the Umweltbundesamt (n.d.). To estimate the emission for lower velocities we used a non-linear least squares regression. We assumed that the reduction in carbon emissions decreases at lower velocities and therefore set a threshold at 75 km/h where the carbon emissions are constant (Metcalfe &amp; Boulter, 2022).</p>
<p><strong>Slope</strong></p>
<p>For calculating the increase in carbon dioxide emission due to inclination when driving, we used the reference values from Xu et al.&nbsp;(2020). In their paper, they measured emissions based on inclination and speed for two different vehicles, a small and a large one. Therefore, in a first step, we calculated the average of these two vehicle types. We then fit a linear model for each 10 km/h speed that calculates the emission increase in percentage based on a certain road inclination for the respective speed category. With these linear models, we calculated the increase in emission for each of our Posmo data points. All the increases at each Posmo data point were then summed up for one user ID and divided by the total number of observations per user. This way we got the mean increase in car carbon dioxide emission per user due to inclination. We only considered an increase in emission when passing a positive slope. We did not include potential reductions in emissions when going downhill.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for cars: we have various sources</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>c_car <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">130</span>, <span class="dv">162</span>, <span class="fl">122.3</span>, <span class="dv">200</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for buses</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>c_bus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">108</span>, <span class="fl">88.7</span>, <span class="fl">25.15</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for trains</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>c_train <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">93</span>, <span class="fl">110.9</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for trams</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>c_tram <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">37</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for e-bikes</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>c_ebike <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># for bikes</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>c_bike <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># create a look-up table for the different emission constants</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>constants_emission <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">transport_mode =</span> transport_modes,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># include values for emissions and calculate mean, median, minimum and maximum</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>constants_emission<span class="sc">$</span>constant_gkm <span class="ot">&lt;-</span> <span class="fu">list</span>(c_car, c_bus, c_train, c_tram, c_bike, c_ebike) </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>constants_emission <span class="ot">&lt;-</span> constants_emission <span class="sc">|&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg =</span> <span class="fu">sapply</span>(constant_gkm, mean),</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">sapply</span>(constant_gkm, median),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">sapply</span>(constant_gkm, min),</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">sapply</span>(constant_gkm, max)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>brauchen wir get_days function oder eigentlich nur get_weeks?? könnte man Funktion umschreiben?</em> Wir bräuchten nur get_weeks. Habe es versucht, hat auf die schnelle nicht geklappt.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to get the number of weekdays recorded per user id</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>get_days <span class="ot">&lt;-</span> <span class="cf">function</span>(user, posmo_data){</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter the user</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  posmo_user <span class="ot">&lt;-</span> posmo_data <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(user_id <span class="sc">==</span> user)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert the datetime format to days and get the unique days</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  recorded_days <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.Date</span>(posmo_user<span class="sc">$</span>datetime, <span class="at">format =</span> <span class="st">"%d"</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the number of unique days</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">length</span>(recorded_days))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># save the unique user_ids in the data set</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>posmo_userids <span class="ot">&lt;-</span> <span class="fu">unique</span>(posmo<span class="sc">$</span>user_id) </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># make an empty data frame with the number of days per users</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> posmo_userids)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to append</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>number_of_days <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>number_of_weeks <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># use the created function</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> posmo_userids){</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">=</span> <span class="fu">get_days</span>(i, posmo)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  number_of_days <span class="ot">&lt;-</span> <span class="fu">append</span>(number_of_days, day)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  week <span class="ot">=</span> day<span class="sc">/</span><span class="dv">7</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  number_of_weeks <span class="ot">&lt;-</span> <span class="fu">append</span>(number_of_weeks, week)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of days and weeks rounded to 3 digits to the user_id</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user<span class="sc">$</span>days <span class="ot">&lt;-</span> number_of_days</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user<span class="sc">$</span>weeks <span class="ot">&lt;-</span> <span class="fu">round</span>(number_of_weeks, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the distances [m], the timelag [s], the speed [m/s], and the speed [km/h]: use group_by to make sure it only calculates for one user id and not between different user ids</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_m =</span> <span class="fu">sqrt</span>((<span class="fu">lead</span>(X, <span class="dv">1</span>) <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">lead</span>(Y, <span class="dv">1</span>) <span class="sc">-</span> Y)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_km =</span> distance_m<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">timelag_s =</span> <span class="fu">as.integer</span>(<span class="fu">difftime</span>(<span class="fu">lead</span>(datetime), datetime),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">units =</span> <span class="st">"secs"</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_ms =</span> (distance_m<span class="sc">/</span>timelag_s),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_kmh =</span> (speed_ms<span class="sc">*</span><span class="fl">3.6</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_change_ms =</span> <span class="fu">lead</span>(speed_ms, <span class="dv">1</span>) <span class="sc">-</span> speed_ms,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">acceleration_ms2 =</span> speed_change_ms<span class="sc">/</span>timelag_s,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">acceleration =</span> acceleration_ms2 <span class="sc">&gt;=</span><span class="dv">0</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA distance values</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(distance_km))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># group by user_id and transport_mode and sum up the distance in km</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  posmo <span class="sc">|&gt;</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, transport_mode) <span class="sc">|&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_km =</span> <span class="fu">sum</span>(distance_km))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># join the lookup table to the initial data frame</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(constants_emission, <span class="at">by =</span> <span class="st">"transport_mode"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># join the number of recording days to the data frame</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user, <span class="at">by =</span> <span class="st">"user_id"</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co"># multiply the CO2 emissions constant with the traveled distance and divide by the number of recorded days</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g =</span> sum_km <span class="sc">*</span> avg,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">co2_emissions_g_per_d =</span> co2_emissions_g<span class="sc">/</span>days,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">co2_emissions_g_per_w =</span> co2_emissions_g<span class="sc">/</span>weeks)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total emissions by user ID and transportation mode</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>emissions <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(co2_emissions_g_per_w <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, posmo_traveldistance, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA and infinitive values</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(speed_kmh)) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(speed_kmh))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check range of speed values</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo<span class="sc">$</span>speed_kmh)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh <span class="sc">&lt;=</span> <span class="dv">200</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># save speed and their respective emission values [g/km] as variables</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>speed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>emission <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">146</span>, <span class="dv">158</span>, <span class="dv">172</span>, <span class="dv">190</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a non-linear least squares regression</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fit_emission <span class="ot">&lt;-</span> <span class="fu">nls</span>(emission <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>(b <span class="sc">*</span> speed), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">100</span>, <span class="at">b =</span> <span class="fl">0.02</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predicting new estimation values</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>speed_new <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">130</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>emission_pred_gkm <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_emission, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">speed =</span> speed_new))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># save the new values in a data frame</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>est_emission_car_speed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(speed_new, emission_pred_gkm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the predicted as well as the old values</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed_new, <span class="at">y =</span> emission_pred_gkm), <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed_new, <span class="at">y =</span> emission_pred_gkm), <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> emission), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> emission), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(<span class="st">"Estimated CO"</span> [<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emission Values for Cars Depending on Speed"</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Estimated values are in blue, known values are in red."</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Speed [km/h]"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>] <span class="sc">~</span> <span class="st">"Emission [g/km]"</span>))<span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fifthFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-fifthFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Estimated car emission values based on speed. Values in red from Umweltbundesamt (n.d.).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to all cars</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_kmh_floored =</span> <span class="fu">floor</span>(speed_kmh<span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># join the emission values for fast movement (car speed over 75km/h)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>posmo_car_fast <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh_floored <span class="sc">&gt;</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est_emission_car_speed, <span class="at">by =</span> <span class="fu">join_by</span>(speed_kmh_floored <span class="sc">==</span> speed_new)) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set the emission value for slow movement (car speed under 75km/h)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>posmo_car_slow <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh_floored <span class="sc">&lt;=</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emission_pred_gkm =</span> <span class="fl">116.41017</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># combine everything together</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> <span class="fu">rbind</span>(posmo_car_fast, posmo_car_slow)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># group by user_id to sum up the distance in km</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>posmo_car_traveldistance <span class="ot">&lt;-</span> </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, emission_pred_gkm) <span class="sc">|&gt;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_km =</span> <span class="fu">sum</span>(distance_km)) <span class="sc">|&gt;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emissions_g =</span> sum_km <span class="sc">*</span> emission_pred_gkm)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># sum up per user</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_traveldistance <span class="sc">|&gt;</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_emissions_g =</span> <span class="fu">sum</span>(emissions_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co"># join with the number of days &amp; weeks per user</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span> </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate emissions per week</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g_per_w =</span> sum_emissions_g<span class="sc">/</span>weeks)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total emissions by user ID and transportation mode</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>emissions_car_speed <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(co2_emissions_g_per_w <span class="sc">~</span> user_id, posmo_car_emissions, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Darstellung eher mit kontinuierlicher Skala anstatt mit einzelnen punkten (falls möglich)</em> Wie ist das gemeint? Höhenwerte für die ganze Schweiz darstellen? Weil wir haben ja nur dort Posmodaten mit Höhe, wo es jetzt Punkte hat. <em>hier habe ich eigentlich gemeint, dass skala nicht punkte ist sondern eher eine kontinuierliche skala mit farbverlauf. so sieht es aus als ob es nur diese 4 höhen gibt</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> height)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Elevation of Posmo Locations"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Posmo data from Switzerland"</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Elevation [m a.s.l.]"</span>))<span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sixthFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-sixthFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Elevation above sea level for posmo trajectories.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for all posmo data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_diff =</span> <span class="fu">lead</span>(height, <span class="dv">1</span>) <span class="sc">-</span> height,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizontal_diff =</span> <span class="fu">sqrt</span>((plus1<span class="sc">**</span><span class="dv">2</span>)<span class="sc">-</span>(height_diff<span class="sc">**</span><span class="dv">2</span>)),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_percent =</span> (height_diff <span class="sc">/</span> horizontal_diff)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all NA values for slope</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(slope_percent))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print the range of the slope values in percentage</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo_car<span class="sc">$</span>slope_percent)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># filter absolute slope values greater than 100%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(slope_percent) <span class="sc">&lt;=</span> <span class="dv">25</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it worked</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo_car<span class="sc">$</span>slope_percent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>emissions_slope <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Slope.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the absolute increase in carbon emission</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">increase_gkm =</span> Emission_slope_gkm <span class="sc">-</span> Emission_flat_gkm,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># calculate the relative increase in carbon emission</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">increase_perc =</span> (increase_gkm<span class="sc">/</span>Emission_flat_gkm) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get the range of speed in the emission file</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(emissions_slope<span class="sc">$</span>Speed_kmh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>filterSpeed <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, min_speed, max_speed){</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Speed_kmh <span class="sc">&gt;=</span> min_speed <span class="sc">&amp;</span> Speed_kmh <span class="sc">&lt;=</span> max_speed)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to the three different groups</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>emissions_slope_slow <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">40</span>, <span class="dv">60</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>emissions_slope_medium <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">70</span>, <span class="dv">90</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>emissions_slope_fast <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">100</span>, <span class="dv">120</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>slopeEmission <span class="ot">&lt;-</span> <span class="cf">function</span>(slope_data){</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  slope_data <span class="sc">|&gt;</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed_kmh, Gradient) <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_increase_perc =</span> <span class="fu">mean</span>(increase_perc))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>emissions_slope_slow <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_slow)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>emissions_slope_medium <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_medium)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>emissions_slope_fast <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_fast)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all into one dataframe</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>emissions_slope <span class="ot">&lt;-</span> emissions_slope_slow <span class="sc">|&gt;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_slope_medium, emissions_slope_fast) <span class="sc">|&gt;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Vehicle <span class="sc">!=</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Vehicle))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>filterSlope <span class="ot">&lt;-</span> <span class="cf">function</span>(emission_data, speed_value){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  emission_data <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Speed_kmh <span class="sc">==</span> speed_value)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># run the function for each speed</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>slope_50kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">50</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>slope_60kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">60</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>slope_70kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">70</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>slope_80kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">80</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>slope_90kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">90</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>slope_100kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">100</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>slope_120kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">120</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>lm_slope50 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_50kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_50kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>lm_slope60 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_60kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_60kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>lm_slope70 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_70kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_70kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>lm_slope80 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_80kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_80kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>lm_slope90 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_90kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_90kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>lm_slope100 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_100kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_100kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>lm_slope120 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_120kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_120kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame with coefficients for each speed level</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>extrapolation_slope_emissions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">speed_kmh =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">120</span>, <span class="dv">130</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                                                          <span class="dv">140</span>, <span class="dv">150</span>, <span class="dv">190</span>),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">intercept_q =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope50<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope60<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope70<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope80<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope90<span class="sc">$</span>coefficients[<span class="dv">1</span>],lm_slope100<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>                                                            (lm_slope100<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>                                                               lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>])<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>]),</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">slope_m =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope50<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope60<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope70<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope80<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope90<span class="sc">$</span>coefficients[<span class="dv">2</span>],lm_slope100<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>                                                        (lm_slope100<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="sc">+</span> lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>])<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>]))</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co"># round speed values to the nearest 10 to join with extrapolation</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_kmh_round =</span> <span class="fu">round</span>(speed_kmh, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co"># join the extrapolation of the emission values with the posmo car data</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(extrapolation_slope_emissions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"speed_kmh_round"</span> <span class="ot">=</span> <span class="st">"speed_kmh"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the increase in emission for each data point</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(slope_percent <span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emission_increase_perc =</span> slope_m <span class="sc">*</span> slope_percent <span class="sc">+</span> intercept_q) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(emission_increase_perc <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># count the number of observations per user</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>observations_user <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(user_id)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase <span class="ot">&lt;-</span> posmo_car<span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_increase_perc =</span> <span class="fu">sum</span>(emission_increase_perc)) <span class="sc">|&gt;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of observations to the data frame with the slope emissions</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase<span class="sc">$</span>observations <span class="ot">&lt;-</span> observations_user<span class="sc">$</span>n</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># get the mean increase for each person's car emission when considering the slope</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase <span class="ot">&lt;-</span> posmo_slope_car_increase<span class="sc">|&gt;</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span> </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_increase_perc =</span> sum_increase_perc<span class="sc">/</span>observations) <span class="sc">|&gt;</span> </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># join the car emissions with the increase of emission because of slope</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span> </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_slope_car_increase, <span class="at">by =</span> <span class="st">"user_id"</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>emissions_car_slope <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g_per_w_slope =</span> co2_emissions_g_per_w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> mean_increase_perc<span class="sc">/</span><span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>The analysis of the weekly emissions of each user shows that for all free users the car and the train provide the highest emissions. Transportation means such as bus, tram, bike or e-bikes produce only small amounts of emissions. If you assess the distances which were travelled with each transport mean (in discussion)</p>
<p>To assess the influence of increasing complexity for the emission values we focused our analysis solely on car emissions. When comparing the emissions calculated with the simple approach and the emissions calculated with the speed approach it is evident that the speed approach resulted in lower emission values for all users. When also including the emissions calculated using the slope and the resulting increase in carbon emissions the emission values for the speed and the slope approach are quite similar. For User 2 and 3 the emissions are higher with the slope approach than for the speed approach (maybe more hilly??) Figure ?? shows the uncertainty which arises when calculating emission values for different transportation modes. The ranges of emission values are especially high for cars as well as buses which is visible in the increased length of the boxes which indicate the range of the possible emissions. User 1 thereby seems to use the car more often whereas user to seems to prefer taking the bus. The calculated emissions from Posmo and our own calculated emission vary a lot. Especially the calculated car and the train emissions show huge differences. For the car emissions Posmo calculates values which are higher than our values. Even the highest emission values we found in the literature is still rather small compared to the Posmo emissions. In contrast, the train emissions calculated by Posmo are a lot smaller than our own emission values. We determined the weekly emissions of the Posmo and our own calculations. Thereby the emissions calculated with Posmo provide much higher values than our weekly emissions calculated with the slope approach.</p>
<section id="simple-scenario" class="level2">
<h2 class="anchored" data-anchor-id="simple-scenario">Simple scenario</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>emissions_bar_simple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"User"</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport mode"</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Car emissions calcualted based on distance"</span>)<span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weeky Emissions per Transportation Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">48000</span>)<span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-seventhFigure</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission based on distances per user normalized over 7 days for different transport modes.</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>emissions_bar_simple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot%20weekly%20emissions%20for%20simple%20approach-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>leider nicht sehr viel aussagend, evtl. emissionen für nur einen weg darstellen und dafür etw. genauer analysieren</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>emissions_plot_simple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo_traveldistance, <span class="fu">aes</span>(<span class="at">color =</span> co2_emissions_g_per_w))<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Emissions per Transport Mode and User"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), <span class="at">type =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-eigthFigure</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spatial reference for CO~2~ emission based on distances per user normalized over 7 days for all transport modes.</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>emissions_plot_simple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot%20weekly%20emissions%20for%20simple%20approach%20on%20map-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="speed-scenario" class="level2">
<h2 class="anchored" data-anchor-id="speed-scenario">Speed scenario</h2>
<p><em>könnte man rausnehmen, hat unten schon plot mit genau der selben info, einfach noch zusammen mit simple scenario.. aber ansonsten redundant</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the simple emission values to only "Car" values</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>emissions_car_simple <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column transport mode to the calculated car emissions using speed information as well</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>emissions_car_speed <span class="ot">&lt;-</span> emissions_car_speed <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="st">"Car"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>emissions_new <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the 'old' emission values for car</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace these values with the new car emissions calculated based on speed</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_car_speed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>restliche tranport modes darstellen??</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the bar chart</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>emissions_plot_speed_car <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_new, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on speed"</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weeky Emissions per Transportation Mode &amp; User"</span>)<span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">45000</span>)<span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-twelthFigure</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Comparison between CO~2~ emission of all transports mode with mode car calculated using a simple distance-based scenario (left) and a scenario based on driving speed (right).</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>emissions_plot_speed_car</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot%20average%20weekly%20emission-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="slope-scenario" class="level2">
<h2 class="anchored" data-anchor-id="slope-scenario">Slope scenario</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column transport mode to the calculated car emissions using speed information as well</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>emissions_car_slope <span class="ot">&lt;-</span> emissions_car_slope <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(user_id, co2_emissions_g_per_w_slope, transport_mode)) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">co2_emissions_g_per_w =</span> co2_emissions_g_per_w_slope)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>emissions_new_slope <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the 'old' emission values for car</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace these values with the new car emissions calculated based on speed</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_car_slope)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create the bar chart</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>emissions_plot_slope_car <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_new_slope, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x =</span> user_id, </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> co2_emissions_g_per_w, </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on slope"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weekly Emissions per Transport Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">48000</span>)<span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-seventeenthFigure</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission values for all transportat modes per user and week with car emissions calculated based on slope and speed.</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>emissions_plot_slope_car</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/add%20car%20emissions%20calculated%20using%20slope%20to%20emission%20data%20and%20create%20bar%20chart-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter increase values between 0.5 and 10%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(emission_increase_perc <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> emission_increase_perc <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> emission_increase_perc))<span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Increase in emission due to slope"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"emission increase [%]"</span>), <span class="at">type =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-thirteenthFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-thirteenthFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Spatial reference of increase in car CO<sub>2</sub> emission due to slope. For better visibility, increase values are limited to values between 0.5 and 10%.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-of-all-three-scenarios" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-all-three-scenarios">Comparison of all three scenarios</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>emissions_car_simple<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"simple"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>emissions_car_speed<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"speed"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>emissions_car_slope<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"slope"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>user_id, emissions_car_slope<span class="sc">$</span>user_id,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                                                      emissions_car_speed<span class="sc">$</span>user_id),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">co2_emissions_g_per_w =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>co2_emissions_g_per_w,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                                                                    emissions_car_speed<span class="sc">$</span>co2_emissions_g_per_w,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                                                                    emissions_car_slope<span class="sc">$</span>co2_emissions_g_per_w),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">scenario =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>scenario,emissions_car_speed<span class="sc">$</span>scenario, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                                                       emissions_car_slope<span class="sc">$</span>scenario))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios_bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_car_all_scenarios, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, <span class="at">fill =</span> scenario)) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Approach"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated using different approaches"</span>) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Overall Car Emissions for All Approaches"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(co2_emissions_g_per_w, <span class="dv">1</span>)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">25000</span>)<span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-thirteenthFigure</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission values for all emission scenarios of car emissions per user and week.</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios_bar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot%20grouped%20bar%20chart%20for%20all%20car%20emission%20scenarios-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comparison-posmo-emission-calculations-and-our-calculations" class="level2">
<h2 class="anchored" data-anchor-id="comparison-posmo-emission-calculations-and-our-calculations">Comparison Posmo emission calculations and our calculations</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to get the daily emissions</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dailyEmission <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_data, constants){</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure Date is provided as date and not as datetime</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  posmo_data<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(posmo_data<span class="sc">$</span>datetime)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  daily_distance <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(distance_km <span class="sc">~</span> user_id <span class="sc">+</span> day <span class="sc">+</span> transport_mode, posmo_data, <span class="at">FUN =</span> sum)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  daily_emission <span class="ot">&lt;-</span> daily_distance <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(constants, <span class="at">by =</span> <span class="st">"transport_mode"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  daily_emission <span class="ot">&lt;-</span> daily_emission <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_emission_kg =</span> distance_km <span class="sc">*</span> avg <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_emission_kg =</span> distance_km <span class="sc">*</span> min <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_emission_kg =</span> distance_km <span class="sc">*</span> max <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(daily_emission)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>daily_emission <span class="ot">&lt;-</span> <span class="fu">dailyEmission</span>(posmo, constants_emission)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>emission_avg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(avg_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>emission_min <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(min_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>emission_max <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(max_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>emission_CH_mode <span class="ot">&lt;-</span> <span class="fu">left_join</span>(emission_avg, emission_min, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(emission_max, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>posmo_emission_1 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Posmo_1.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_id =</span> <span class="st">"1af6fc8e-273d-4889-894b-5dadadd70a01"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">dmy</span>(Date)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>posmo_emission_2 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Posmo_2.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_id =</span> <span class="st">"6e119464-37a3-4d4e-9eaf-ef1b7e137b60"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">dmy</span>(Date)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>posmo_emission <span class="ot">&lt;-</span> <span class="fu">rbind</span>(posmo_emission_1, posmo_emission_2)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>emission_posmo_mode <span class="ot">&lt;-</span> posmo_emission <span class="sc">|&gt;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>(transport_mode, emission, <span class="sc">-</span>user_id, <span class="sc">-</span>Date, <span class="sc">-</span>Airplane, <span class="sc">-</span>Notes, <span class="sc">-</span>Sum_all, <span class="sc">-</span>Sum_CH) <span class="sc">|&gt;</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origin =</span> <span class="st">"posmo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(user_id, Date, transport_mode, emission, origin) <span class="sc">|&gt;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate</span>(emission <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, sum)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>emission_cal_posmo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(emission_posmo_mode, emission_CH_mode, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> emission_cal_posmo)<span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">ymin =</span> min_emission_kg, <span class="at">ymax =</span> max_emission_kg, <span class="at">color =</span> user_id), </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">ymin =</span> avg_emission_kg<span class="fl">-0.5</span>, <span class="at">ymax =</span> avg_emission_kg<span class="fl">+0.5</span>, <span class="at">color =</span> user_id),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>), </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"User 1"</span>, <span class="st">"User 2"</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Users"</span>)) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">y =</span> emission, <span class="at">color =</span> user_id),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Locations with acceleration"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>] <span class="sc">~</span> <span class="st">"Emission [g/km]"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-eighteenthFigure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-eighteenthFigure-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: CO<sub>2</sub> Emissions of Different Transportation Modes.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>userid <span class="ot">&lt;-</span> <span class="fu">unique</span>(posmo_emission<span class="sc">$</span>user_id) </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make an empty data frame with the number of days per users</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>days_per_user <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> userid)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to append</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># use the created function</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> userid){</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">=</span> <span class="fu">get_days</span>(i, posmo)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  week <span class="ot">=</span> day<span class="sc">/</span><span class="dv">7</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  num_weeks <span class="ot">&lt;-</span> <span class="fu">append</span>(num_weeks, week)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of days and weeks rounded to 3 digits to the user_id</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>days_per_user<span class="sc">$</span>weeks <span class="ot">&lt;-</span> <span class="fu">round</span>(num_weeks, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>posmo_emission_week <span class="ot">&lt;-</span> emission_posmo_mode <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user, <span class="at">by =</span> <span class="st">"user_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_weekly =</span> emission<span class="sc">/</span>weeks</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(emissions_car_slope, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">co2_emission_kg_per_w =</span> co2_emissions_g_per_w <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>noch nicht gut, nicht wirklich schön oder viel aussagend; gibt es bei slope calculation auch eine range oder haben wir da nur jeweils einen wert berechnet??</em></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(posmo_emission_week) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> emissions_weekly), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emission_kg_per_w), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="sc">-</span><span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on slope"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weekly Emissions per Transport Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p><em>vlt gibt posmo infos dazu wie emissionen berechet werden; vergleich mit eigenen annahmen.</em></p>
<p>Posmo pursues a more restrictive approach when calculating the emissions for trains. These differences could be explained by different assumptions in capacity utilization or the power unit of the train.</p>
<p>For the car emission calculations our calculations were more optimistic than the ones from Posmo. An explanation could be that our values refer to the standards of new cars registered in the last few years. These may have higher requirements to be admitted and therefore do not correspond to the average emissions.</p>
<p><em>evtl wäre vorher mal noch eine abbildung gut wo wir sagen was die zurückgelegten distanzen sind pro verkehrsmittel um etw. relativieren zu können</em></p>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>Our analysis was prone to several limitations. These ranged from inaccuracies in the data to limitations in our methods. Although we worked with only validated data from the Posmo app, there were inaccuracies present. For example, sometimes speed values were exceptionally high or there was a time lag of 0 between two data points but they were at different locations. Due to theses inaccuracies we excluded all the outliers which led to a reduced amount of data and assumptions we had to make. Another limitations concerning our data was that we only had data sets of three different users which may have not represented the grand public well. Further, we used very simplified approaches to calculate the emissions. We considered various sources for the emission constants in the first and most simple approach, however there are for sure many more sources stating different values. For the speed approach we also used a very simplified method with using one source and extrapolation its observed values. Here, we do not consider anything about car size, fuel type, and so on. Pretty much the same goes for the slope scenario. While the height values extracted from the DHM were quite accurate, the rest of this approach very likely was not. We used values from only one source (Xu et al., 2020) to extrapolated the increase in emission based on the inclination. The sources used two vehicle types with different sizes whereas we averaged for both types. As we only used positive slopes which cause an increase in emission, our calculated increase values were possible to high. Overall, there are many assumptions that we made an also many times that we had to average over certain car types, environmental factors, and so on. Furthermore, we also did not include the occupancy rate of any public transportation vehicle or the cars as we simple did not have easily accessible data about that. The same goes for the influence of the fuel type. We do not know what kind of cars our three users drive which is why we could not consider fuel type of cars in our analysis either.</p>
</section>
<section id="outlook" class="level2">
<h2 class="anchored" data-anchor-id="outlook">Outlook</h2>
<p>There are many factors that could have been included in our analysis as stated above. One thing that we did not include and would suggest to do as a next step is including the emission increase due to acceleration. Acceleration also has an influence on the emissions of cars and emissions change significantly with changing speed (Dong et al., 2022). In the figure below, we can see where there are locations with acceleration and where there are locations with deceleration.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> acceleration))<span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Locations with acceleration"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Acceleration"</span>))<span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sources" class="level2">
<h2 class="anchored" data-anchor-id="sources">Sources</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Bundesamt für Landestopographie swisstopo (no date a): DHM25. URL: <a href="https://www.swisstopo.admin.ch/de/geodata/height/dhm25.html#download" class="uri">https://www.swisstopo.admin.ch/de/geodata/height/dhm25.html#download</a> (as at: no date) (last access: 05.06.2023).</p>
<p>Bundesamt für Landestopographie swisstopo (no date b): swissBOUNDARIES3D URL: &lt;https://www.swisstopo.admin.ch/de/geodata/landscape/boundaries3d.html &gt; (as at: no date) (last access: 05.06.2023).</p>
<section id="car-emissions" class="level4">
<h4 class="anchored" data-anchor-id="car-emissions">Car emissions</h4>
<p>Bundesamt für Statistik BFS (2023): Fahrzeuge und Transportmittelbestände des Güterverkehrs. URL: <a href="https://www.bfs.admin.ch/bfs/de/home/statistiken/raum-umwelt/umweltindikatoren/alle-indikatoren/reaktionen-der-gesellschaft/co2-ausstoss-personenwagen.assetdetail.23908017.html" class="uri">https://www.bfs.admin.ch/bfs/de/home/statistiken/raum-umwelt/umweltindikatoren/alle-indikatoren/reaktionen-der-gesellschaft/co2-ausstoss-personenwagen.assetdetail.23908017.html</a> (as at: 05.04.2023) (last access: 05.06.2023).</p>
<p>Deutsche Physikalische Gesellschaft (2022): CO2-Emissionen beim Reisen. URL: <a href="https://www.dpg-physik.de/vereinigungen/fachuebergreifend/ak/akjdpg/wir/arbeitsteams/nachhaltigkeit/nachgeforscht/co2-emissionen-beim-reisen" class="uri">https://www.dpg-physik.de/vereinigungen/fachuebergreifend/ak/akjdpg/wir/arbeitsteams/nachhaltigkeit/nachgeforscht/co2-emissionen-beim-reisen</a> (as at: 01.01.2022) (last access: 05.06.2023).</p>
<p>Europäisches Parlament (2018): Senkung der Emissionen: Neue CO₂-Ziele für Pkw und leichte Nutzfahrzeug. URL: <a href="https://www.europarl.europa.eu/news/de/headlines/society/20180920STO14027/senkung-der-emissionen-neue-co2-ziele-fur-pkw-und-leichte-nutzfahrzeuge" class="uri">https://www.europarl.europa.eu/news/de/headlines/society/20180920STO14027/senkung-der-emissionen-neue-co2-ziele-fur-pkw-und-leichte-nutzfahrzeuge</a> (as at: 15.02.2023) (last access: 05.06.2023).</p>
<p>Umweltbundesamt (2014): E-Rad macht mobil. Potenziale von Pedelecs und deren Umweltwirkung. URL: <a href="https://www.umweltbundesamt.de/sites/default/files/medien/378/publikationen/hgp_e-rad_macht_mobil_-_pelelecs_4.pdf" class="uri">https://www.umweltbundesamt.de/sites/default/files/medien/378/publikationen/hgp_e-rad_macht_mobil_-_pelelecs_4.pdf</a> (as at: 01.08.2014) (last access: 05.06.2023).</p>
<p>Umweltbundesamt (2021): Vergleich der durchschnittlichen Emissionen einzelner Verkehrsmittel Personenverkehr in Deutschland 2021. URL: <a href="https://www.umweltbundesamt.de/sites/default/files/medien/366/bilder/dateien/uba_emissionstabelle_personenverkehr_2021_0.pdf" class="uri">https://www.umweltbundesamt.de/sites/default/files/medien/366/bilder/dateien/uba_emissionstabelle_personenverkehr_2021_0.pdf</a> (as at: 01.12.2022) (last access: 05.06.2023).</p>
<p>Umweltbundesamt (no date): Niedrigere Geschwindigkeit spart Energie und schont die Umwelt. URL: <a href="https://www.umweltbundesamt.at/umweltthemen/mobilitaet/mobilitaetsdaten/tempo" class="uri">https://www.umweltbundesamt.at/umweltthemen/mobilitaet/mobilitaetsdaten/tempo</a> (as at: no date) (last access: 21.06.2023).</p>
<p>umweltnetz-schweiz (2019): Klimabaustein: Bus oder Bahn? URL: <a href="https://www.umweltnetz-schweiz.ch/themen/klima/3101-klimabaustein-bus-oder-bahn.html#:~:text=Autobusse%20dagegen%20verursachen%20rund%20145,rund%2037%20g%2FPkm%20ausstossen" class="uri">https://www.umweltnetz-schweiz.ch/themen/klima/3101-klimabaustein-bus-oder-bahn.html#:~:text=Autobusse%20dagegen%20verursachen%20rund%20145,rund%2037%20g%2FPkm%20ausstossen</a> (as at: 18.01.2019) (last access: 05.06.2023).</p>
<p>World Wide Fund for Nature (2020): Autoverkehr und Elektromobilität. URL: <a href="https://www.wwf.ch/de/unsere-ziele/autoverkehr-und-elektromobilitaet" class="uri">https://www.wwf.ch/de/unsere-ziele/autoverkehr-und-elektromobilitaet</a> (as at: no date) (last access: 05.06.2023).</p>
</section>
<section id="slope-threshold" class="level4">
<h4 class="anchored" data-anchor-id="slope-threshold">Slope threshold</h4>
<p>Wikipedia (2022): Balmberg. URL: <a href="https://de.wikipedia.org/wiki/Balmberg" class="uri">https://de.wikipedia.org/wiki/Balmberg</a> (as at: 02.10.2022) (last access: 28.06.2023).</p>
</section>
</section>
<section id="literature" class="level3">
<h3 class="anchored" data-anchor-id="literature">Literature</h3>
<p><strong>Bundesamt für Statistik BFS, Bundesamt für Raumplanung ARE</strong> (2023): Mikrozensus Mobilität und Verkehr (MZMV).</p>
<p><strong>Dong, Yaping; Xu, Jinliang; Ni, Jie</strong> (2022): Carbon emission model of vehicles driving at fluctuating speed on highway. In: Environmental Science and Pollution Research, Vol. 30, pp.&nbsp;18064-18077.</p>
<p><strong>Knupfer, G. (Handelszeitung)</strong> (2014): Die SBB fahren im Vergleich im Schneckentempo. URL: <a href="https://www.handelszeitung.ch/unternehmen/die-sbb-fahren-im-vergleich-im-schneckentempo-660389" class="uri">https://www.handelszeitung.ch/unternehmen/die-sbb-fahren-im-vergleich-im-schneckentempo-660389</a> (as at: 29.08.2014) (last access: 28.06.2023).</p>
<p><strong>Metcalfe, J.; Boulter &amp; P.</strong> (2022). Effect of speed on greenhouse gas emissions from road transport: a review. Report prepared by Emission Impossible Ltd, and EMM Consulting, for Waka Kotahi, December, 2022.</p>
<p><strong>Suarez, Jaime; Makridis, Michail; Anesiadou, Aikaterini; Komnos, Dimitrios; Ciuffo, Biagio; Fontaras, Georgios</strong> (2022): Benchmarking the driver acceleration impact on vehicle energy consumption and CO2 emissions. In: Transportation Research Part D, Vol. 107.</p>
<p><strong>Xu, Jinliang; Dong, Yaping &amp; Yan, Menghua</strong> (2020): A Model for Estimating Passenger-Car Carbon Emissions that Accounts for Uphill, Downhill and Flat Roads. In: Sustainability, Vol. 12, No.&nbsp;2028.</p>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Calculation of carbon dioxide emissions from movement trajectories</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> GEO880 - Computational Movment Analysis (UZH) / Patterns and Trends in Environmental Data (ZHAW)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Laura Haus and Antonia Hehli</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 07.02.2023</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="an">fig_caption:</span><span class="co"> yes</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">  output: false</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries, warning = FALSE, message = FALSE}</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminaries</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Import libraries</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readr"</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"raster"</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sf"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"terra"</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Abstract</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>Mobility is an important source for carbon dioxide emission whereas road transportation is responsible for around 20 percent of global carbon dioxide emissions. Using movement data from Posmo we determined the emissions based on approaches with increasing complexities. Thereby we used 3 different validated data sets. There are significant differences in the calculations of carbon emissions depending on the complexity of the approach. In our assessement an increased complexity lead to decreased emissions. Our study revealed that the calculation of emissions depends on many variables and factors which are difficult to include in a holistic analysis.  </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>Road transportation is responsible for around 20 percent of global carbon dioxide emission whereof almost half of these emissions are caused by passenger road vehicles (Suarez et al., 2022). Due to the strongly negative impact of carbon dioxide emissions on climate change, they world widely receive gradually increasing concern (Dong et al., 2022). Driving behavior like acceleration as well as terrain characteristics such as an incline have valid impacts on carbon dioxide emissions (Dong et al., 2022; Suarez et al., 2022; Xu et al., 2022).</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>However, road traffic is not the only type of traffic that causes carbon dioxide emissions. Trains, trams, and – when also taking production emissions into account – even bicycles cause carbon dioxide emissions. Therefore, we will also take these transportation modes into account. In this project, we analyze carbon dioxide emissions by different transportation types using different complexity levels as well as emission scenarios and compare these different setups with each other. We use validated movement data collected by the Posmo app from 3 students of the course Computational Movement Analysis in Spring 2023 at ZHAW.</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>The objective of this report is to determine the weekly average emissions per person for each transportation mode. Thereby, we additionally want to analyse how much the complexity of an approach changes the results for carbon emissions calculations. Furthermore, we compare the results of our calculation with the emissions provided by Posmo and assess the differences for each transportation mode.</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data and Methods</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Set</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>For the analysis of the emissions, we included Posmo data from a data pool provided in the course. As the exact used transportation mode is crucial in our assessment we only included data sets which were validated, which reduced the included data sets to three. Finally, our data set includes 111’253 data points with the following attributes:</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>user_id</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>datetime</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>weekday</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>transport_mode</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>lon_x</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>lat_y</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>The Posmo data has different temporal time spans for the different people. Data set 1 spans from April 1^st^ to May 11^th^ 2023, data set 2 from April 6^th^ to June 11^th^ and data set 3 from April 11^th^ to June 16^th^ 2023. The temporal resolution of our tracking data varies between 5 and 15 seconds.</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pre-Processing</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>Pre-processing was needed to be able to use our data set for the further analysis. We decided to reduce our assessment area to Switzerland. First, our emission data is mostly based on Swiss and German data and differences in emissions in other countries are possible. Second, we included a slope analysis which would have been too expensive to calculate for multiple countries. The outlines of Switzerland were pre-processed using QGIS.</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>We only included transportation modes which generate carbon dioxide emissions. We do not include airplanes in our considerations as we are only going to focus on trajectories in Switzerland. Finally, we included in our analysis car, bus, train, tram as well as e-bikes and bikes as they produce carbon emissions when taking the production process into account.</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>Additionally, we removed all static points as we are interested in the emissions of moving vehicles. We thereby considered a threshold of 215m. The average velocity of a bicycle is 12.8 km/h (BFS &amp; ARE, 2023). With an assumed average tracking cycle of 10 seconds this would correspond with a distance of around 215 meters which a bicycle could drive in 60 seconds (moving window includes 6 time stamps). </span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>We filtered velocities which exceeded 200 km/h, which is the highest velocities some InterCity trains in Switzerland travel (Knupfer, 2014). We also set the minimum speed to 10 as this corresponds with the average velocity of our slowest transportation mode, bicycle.  </span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>Furthermore, we excluded all slopes which are steeper than 25%, which corresponds to 14.4° as the steepest mountain pass slope in Switzerland is around this value (Wikipedia, 2022).</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r define function loadPosmoData then load data and filter to only Switzerland}</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to load the posmo data</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>loadPosmoData <span class="ot">&lt;-</span> <span class="cf">function</span>(filepath){</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_delim</span>(filepath, <span class="at">delim =</span> <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove the place name</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(place_name)) <span class="sc">|&gt;</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove NA values for transport mode, we need a specified transport mode</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(transport_mode))</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="co"># load all validated Posmo track files</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>posmo1 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_1.csv"</span>) <span class="co"># our own data</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>posmo2 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_2.csv"</span>) <span class="co"># our own data</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>posmo3 <span class="ot">&lt;-</span> <span class="fu">loadPosmoData</span>(<span class="st">"data/posmo_tracks/posmo_3.csv"</span>) <span class="co"># Posmo data tracking pool</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">full_join</span>(posmo1, posmo2)</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">full_join</span>(posmo, posmo3)</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="co"># remove rows with NA in the coordinates</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo[<span class="sc">!</span><span class="fu">is.na</span>(posmo<span class="sc">$</span>lon_x), ]</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf object and transform to LV95</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(posmo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon_x"</span>, <span class="st">"lat_y"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2056</span>)</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a><span class="co"># extract coordinates</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>posmo_coord <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(posmo)</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="co"># create one dataframe</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">cbind</span>(posmo, posmo_coord)</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="co"># read Switzerland and the cantons</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>CH_boundaries <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/swissboundaries3D/CH_boundaries.gpkg"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>CH_cantons <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/swissboundaries3D/CH_cantons.gpkg"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="co"># filter points that are within Switzerland</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> <span class="fu">st_filter</span>(posmo, CH_boundaries)</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot all Posmo tracks in Switzerland, output = TRUE}</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-firstFigure</span></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: All posmo tracks from the three data set, colored by transport mode.</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it worked</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> transport_mode), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>)) <span class="sc">+</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Posmo tracks in Switzerland"</span>) <span class="sc">+</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Transport Mode"</span>))<span class="sc">+</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter transportation modes}</span></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="co"># get all the transportation modes</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(posmo<span class="sc">$</span>transport_mode)</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a><span class="co"># save transportation modes we need in a vector</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>transport_modes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Car"</span>, <span class="st">"Bus"</span>, <span class="st">"Train"</span>, <span class="st">"Tram"</span>, <span class="st">"Bike"</span>, <span class="st">"E_Bike"</span>)</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to only the transportation modes we need</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">%in%</span> transport_modes)</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r define functions for moving window and calculate static points}</span></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a><span class="co"># functions to determine moving window</span></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>movingWindowLag <span class="ot">&lt;-</span> <span class="cf">function</span>(E, N, n){</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((<span class="fu">lag</span>(E, n) <span class="sc">-</span> E)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">lag</span>(N, n) <span class="sc">-</span> N)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>movingWindowLead <span class="ot">&lt;-</span> <span class="cf">function</span>(E, N, n){</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((E <span class="sc">-</span> <span class="fu">lead</span>(E, n))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (N <span class="sc">-</span> <span class="fu">lead</span>(N, n))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate moving window</span></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus3 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">3</span>),</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus2 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">2</span>),</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">minus1 =</span> <span class="fu">movingWindowLag</span>(X, Y, <span class="dv">1</span>),</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus1 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">1</span>),</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus2 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">2</span>),</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">plus3 =</span> <span class="fu">movingWindowLead</span>(X, Y, <span class="dv">3</span>)</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean step length</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(minus3, minus2, minus1, plus1, plus2, plus3))</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="co"># define a column 'static'</span></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">static =</span> stepMean <span class="sc">&lt;</span> <span class="dv">215</span>)</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot static/non-static points, output = TRUE}</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-secondFigure</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Static and non-static parts of the Posmo trajectories.</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="co"># plot whether trajectories are static or not</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>posmo <span class="sc">|&gt;</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(X,Y)) <span class="sc">+</span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> static)) <span class="sc">+</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Static and non-static points in the trajectories"</span>,</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Static"</span>)<span class="sc">+</span></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a><span class="co"># remove static points</span></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>static)</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read DHM convert Posmo data to LV03 and extract height information of DHM}</span></span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a><span class="co"># read the raster data using the terra package</span></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>dhm25 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/DHM25/dhm25_grid_raster.asc"</span>)</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a><span class="co"># set the raster crs to LV03</span></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(dhm25) <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crs</span>(<span class="st">"+init=EPSG:21781"</span>)</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="co"># convert Posmo data to LV03 to match the CRS of the DHM25</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>posmo_lv03 <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">21781</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(X, Y))</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the height information for each Posmo location</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>height_dhm <span class="ot">&lt;-</span> <span class="fu">extract</span>(dhm25, posmo_lv03)</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="co"># join the height back to the posmo data</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>posmo<span class="sc">$</span>height <span class="ot">&lt;-</span> height_dhm<span class="sc">$</span>dhm25_grid_raster</span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>To calculate the emissions we first had to determine values for the carbon dioxide emissions for the considered transportation means. As they strongly vary depending on the sources we included multiple values for some of the transportation modes. </span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>To calculate our weekly emission we determined the average value of the collected emission values for each transportation mode and multiplied it with the distance. </span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>As the time period when people collected Posmo data does not correspond we needed to normalize the emission values for each person to determine the 7-days average. </span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>In order to determine the influence of the complexity of an approach we also considered other factors such as the effect of velocity or slope on the carbon emissions. These additional factors were only calculated and compared for the emissions of cars as this is the transportat mode that each can control a lot themselves when driving as compared to when travelling in a train or bus for example.</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>**Speed**</span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>Information about the change in car emission for velocities between 100 and 130 km/h were provided by the Umweltbundesamt (n.d.). To estimate the emission for lower velocities we used a non-linear least squares regression. We assumed that the reduction in carbon emissions decreases at lower velocities and therefore set a threshold at 75 km/h where the carbon emissions are constant (Metcalfe &amp; Boulter, 2022).</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>**Slope**</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>For calculating the increase in carbon dioxide emission due to inclination when driving, we used the reference values from Xu et al. (2020). In their paper, they measured emissions based on inclination and speed for two different vehicles, a small and a large one. Therefore, in a first step, we calculated the average of these two vehicle types. We then fit a linear model for each 10 km/h speed that calculates the emission increase in percentage based on a certain road inclination for the respective speed category. With these linear models, we calculated the increase in emission for each of our Posmo data points. All the increases at each Posmo data point were then summed up for one user ID and divided by the total number of observations per user. This way we got the mean increase in car carbon dioxide emission per user due to inclination. We only considered an increase in emission when passing a positive slope. We did not include potential reductions in emissions when going downhill.</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create dataframe with constants for emissions}</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a><span class="co"># for cars: we have various sources</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>c_car <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">130</span>, <span class="dv">162</span>, <span class="fl">122.3</span>, <span class="dv">200</span>) </span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="co"># for buses</span></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>c_bus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">108</span>, <span class="fl">88.7</span>, <span class="fl">25.15</span>)</span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="co"># for trains</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>c_train <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">93</span>, <span class="fl">110.9</span>)</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a><span class="co"># for trams</span></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>c_tram <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">37</span>)</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a><span class="co"># for e-bikes</span></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>c_ebike <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a><span class="co"># for bikes</span></span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>c_bike <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a><span class="co"># create a look-up table for the different emission constants</span></span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>constants_emission <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">transport_mode =</span> transport_modes,</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="co"># include values for emissions and calculate mean, median, minimum and maximum</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a>constants_emission<span class="sc">$</span>constant_gkm <span class="ot">&lt;-</span> <span class="fu">list</span>(c_car, c_bus, c_train, c_tram, c_bike, c_ebike) </span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a>constants_emission <span class="ot">&lt;-</span> constants_emission <span class="sc">|&gt;</span></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg =</span> <span class="fu">sapply</span>(constant_gkm, mean),</span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">sapply</span>(constant_gkm, median),</span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">sapply</span>(constant_gkm, min),</span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">sapply</span>(constant_gkm, max)</span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>*brauchen wir get_days function oder eigentlich nur get_weeks?? könnte man Funktion umschreiben?* Wir bräuchten nur get_weeks. Habe es versucht, hat auf die schnelle nicht geklappt. </span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r define function to get the number of days per user and calculate it}</span></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to get the number of weekdays recorded per user id</span></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>get_days <span class="ot">&lt;-</span> <span class="cf">function</span>(user, posmo_data){</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter the user</span></span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a>  posmo_user <span class="ot">&lt;-</span> posmo_data <span class="sc">|&gt;</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(user_id <span class="sc">==</span> user)</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert the datetime format to days and get the unique days</span></span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>  recorded_days <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">as.Date</span>(posmo_user<span class="sc">$</span>datetime, <span class="at">format =</span> <span class="st">"%d"</span>))</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the number of unique days</span></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">length</span>(recorded_days))</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a><span class="co"># save the unique user_ids in the data set</span></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>posmo_userids <span class="ot">&lt;-</span> <span class="fu">unique</span>(posmo<span class="sc">$</span>user_id) </span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a><span class="co"># make an empty data frame with the number of days per users</span></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> posmo_userids)</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to append</span></span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>number_of_days <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>number_of_weeks <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a><span class="co"># use the created function</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> posmo_userids){</span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">=</span> <span class="fu">get_days</span>(i, posmo)</span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>  number_of_days <span class="ot">&lt;-</span> <span class="fu">append</span>(number_of_days, day)</span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>  week <span class="ot">=</span> day<span class="sc">/</span><span class="dv">7</span></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>  number_of_weeks <span class="ot">&lt;-</span> <span class="fu">append</span>(number_of_weeks, week)</span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of days and weeks rounded to 3 digits to the user_id</span></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user<span class="sc">$</span>days <span class="ot">&lt;-</span> number_of_days</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a>posmo_days_per_user<span class="sc">$</span>weeks <span class="ot">&lt;-</span> <span class="fu">round</span>(number_of_weeks, <span class="dv">3</span>)</span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calculate emissions}</span></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the distances [m], the timelag [s], the speed [m/s], and the speed [km/h]: use group_by to make sure it only calculates for one user id and not between different user ids</span></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_m =</span> <span class="fu">sqrt</span>((<span class="fu">lead</span>(X, <span class="dv">1</span>) <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">lead</span>(Y, <span class="dv">1</span>) <span class="sc">-</span> Y)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_km =</span> distance_m<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">timelag_s =</span> <span class="fu">as.integer</span>(<span class="fu">difftime</span>(<span class="fu">lead</span>(datetime), datetime),</span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a>                           <span class="at">units =</span> <span class="st">"secs"</span>),</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_ms =</span> (distance_m<span class="sc">/</span>timelag_s),</span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_kmh =</span> (speed_ms<span class="sc">*</span><span class="fl">3.6</span>),</span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed_change_ms =</span> <span class="fu">lead</span>(speed_ms, <span class="dv">1</span>) <span class="sc">-</span> speed_ms,</span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">acceleration_ms2 =</span> speed_change_ms<span class="sc">/</span>timelag_s,</span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">acceleration =</span> acceleration_ms2 <span class="sc">&gt;=</span><span class="dv">0</span></span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA distance values</span></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span> </span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(distance_km))</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="co"># group by user_id and transport_mode and sum up the distance in km</span></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> </span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a>  posmo <span class="sc">|&gt;</span> </span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, transport_mode) <span class="sc">|&gt;</span></span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_km =</span> <span class="fu">sum</span>(distance_km))</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a><span class="co"># join the lookup table to the initial data frame</span></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span> </span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(constants_emission, <span class="at">by =</span> <span class="st">"transport_mode"</span>)</span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a><span class="co"># join the number of recording days to the data frame</span></span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span> </span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user, <span class="at">by =</span> <span class="st">"user_id"</span>)</span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="co"># multiply the CO2 emissions constant with the traveled distance and divide by the number of recorded days</span></span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>posmo_traveldistance <span class="ot">&lt;-</span> posmo_traveldistance <span class="sc">|&gt;</span></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g =</span> sum_km <span class="sc">*</span> avg,</span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>         <span class="at">co2_emissions_g_per_d =</span> co2_emissions_g<span class="sc">/</span>days,</span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>         <span class="at">co2_emissions_g_per_w =</span> co2_emissions_g<span class="sc">/</span>weeks)</span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total emissions by user ID and transportation mode</span></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>emissions <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(co2_emissions_g_per_w <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, posmo_traveldistance, sum)</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove speed outliers and save known speed and corresponding emission values}</span></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA and infinitive values</span></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(speed_kmh)) <span class="sc">|&gt;</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(speed_kmh))</span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="co"># check range of speed values</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo<span class="sc">$</span>speed_kmh)</span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a>posmo <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh <span class="sc">&lt;=</span> <span class="dv">200</span>)</span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a><span class="co"># save speed and their respective emission values [g/km] as variables</span></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a>speed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">120</span>, <span class="dv">130</span>)</span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a>emission <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">146</span>, <span class="dv">158</span>, <span class="dv">172</span>, <span class="dv">190</span>)</span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r interpolation of car speed values}</span></span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a non-linear least squares regression</span></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>fit_emission <span class="ot">&lt;-</span> <span class="fu">nls</span>(emission <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>(b <span class="sc">*</span> speed), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">100</span>, <span class="at">b =</span> <span class="fl">0.02</span>))</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a><span class="co"># predicting new estimation values</span></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a>speed_new <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">130</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>emission_pred_gkm <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_emission, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">speed =</span> speed_new))</span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a><span class="co"># save the new values in a data frame</span></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>est_emission_car_speed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(speed_new, emission_pred_gkm)</span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot known and interpolated emission values depending on speed, output = TRUE}</span></span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-fifthFigure</span></span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Estimated car emission values based on speed. Values in red from Umweltbundesamt (n.d.).</span></span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the predicted as well as the old values</span></span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed_new, <span class="at">y =</span> emission_pred_gkm), <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed_new, <span class="at">y =</span> emission_pred_gkm), <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> emission), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> emission), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(<span class="st">"Estimated CO"</span> [<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emission Values for Cars Depending on Speed"</span>),</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Estimated values are in blue, known values are in red."</span>,</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Speed [km/h]"</span>,</span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>] <span class="sc">~</span> <span class="st">"Emission [g/km]"</span>))<span class="sc">+</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include cars only join emission values and calculate emissions}</span></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to all cars</span></span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo <span class="sc">|&gt;</span></span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span></span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_kmh_floored =</span> <span class="fu">floor</span>(speed_kmh<span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a><span class="co"># join the emission values for fast movement (car speed over 75km/h)</span></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a>posmo_car_fast <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh_floored <span class="sc">&gt;</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est_emission_car_speed, <span class="at">by =</span> <span class="fu">join_by</span>(speed_kmh_floored <span class="sc">==</span> speed_new)) <span class="sc">|&gt;</span></span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a><span class="co"># set the emission value for slow movement (car speed under 75km/h)</span></span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>posmo_car_slow <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(speed_kmh_floored <span class="sc">&lt;=</span> <span class="dv">75</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emission_pred_gkm =</span> <span class="fl">116.41017</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="co"># combine everything together</span></span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> <span class="fu">rbind</span>(posmo_car_fast, posmo_car_slow)</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a><span class="co"># group by user_id to sum up the distance in km</span></span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a>posmo_car_traveldistance <span class="ot">&lt;-</span> </span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a>  posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, emission_pred_gkm) <span class="sc">|&gt;</span></span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_km =</span> <span class="fu">sum</span>(distance_km)) <span class="sc">|&gt;</span></span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emissions_g =</span> sum_km <span class="sc">*</span> emission_pred_gkm)</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a><span class="co"># sum up per user</span></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_traveldistance <span class="sc">|&gt;</span></span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_emissions_g =</span> <span class="fu">sum</span>(emissions_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a><span class="co"># join with the number of days &amp; weeks per user</span></span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span> </span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user)</span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate emissions per week</span></span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span></span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g_per_w =</span> sum_emissions_g<span class="sc">/</span>weeks)</span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total emissions by user ID and transportation mode</span></span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>emissions_car_speed <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(co2_emissions_g_per_w <span class="sc">~</span> user_id, posmo_car_emissions, sum)</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>*Darstellung eher mit kontinuierlicher Skala anstatt mit einzelnen punkten (falls möglich)* Wie ist das gemeint? Höhenwerte für die ganze Schweiz darstellen? Weil wir haben ja nur dort Posmodaten mit Höhe, wo es jetzt Punkte hat. *hier habe ich eigentlich gemeint, dass skala nicht punkte ist sondern eher eine kontinuierliche skala mit farbverlauf. so sieht es aus als ob es nur diese 4 höhen gibt*</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot height values for all posmo data, output = TRUE}</span></span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sixthFigure</span></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Elevation above sea level for posmo trajectories.</span></span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> height)) <span class="sc">+</span></span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>,</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Elevation of Posmo Locations"</span>,</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Posmo data from Switzerland"</span>) <span class="sc">+</span></span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Elevation [m a.s.l.]"</span>))<span class="sc">+</span></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calculate slope in percentage and remove outliers}</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a><span class="co"># for all posmo data</span></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id)<span class="sc">|&gt;</span></span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">height_diff =</span> <span class="fu">lead</span>(height, <span class="dv">1</span>) <span class="sc">-</span> height,</span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizontal_diff =</span> <span class="fu">sqrt</span>((plus1<span class="sc">**</span><span class="dv">2</span>)<span class="sc">-</span>(height_diff<span class="sc">**</span><span class="dv">2</span>)),</span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_percent =</span> (height_diff <span class="sc">/</span> horizontal_diff)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all NA values for slope</span></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(slope_percent))</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a><span class="co"># print the range of the slope values in percentage</span></span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo_car<span class="sc">$</span>slope_percent)</span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="co"># filter absolute slope values greater than 100%</span></span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(slope_percent) <span class="sc">&lt;=</span> <span class="dv">25</span>)</span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it worked</span></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(posmo_car<span class="sc">$</span>slope_percent)</span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load and mutate slope emissions, message = FALSE}</span></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>emissions_slope <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Slope.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the absolute increase in carbon emission</span></span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">increase_gkm =</span> Emission_slope_gkm <span class="sc">-</span> Emission_flat_gkm,</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>         <span class="co"># calculate the relative increase in carbon emission</span></span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>         <span class="at">increase_perc =</span> (increase_gkm<span class="sc">/</span>Emission_flat_gkm) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a><span class="co"># get the range of speed in the emission file</span></span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(emissions_slope<span class="sc">$</span>Speed_kmh)</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calculate increase in emission depending on gradient and speed}</span></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a>filterSpeed <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, min_speed, max_speed){</span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>  dataset <span class="sc">|&gt;</span> </span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Speed_kmh <span class="sc">&gt;=</span> min_speed <span class="sc">&amp;</span> Speed_kmh <span class="sc">&lt;=</span> max_speed)</span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to the three different groups</span></span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>emissions_slope_slow <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">40</span>, <span class="dv">60</span>)</span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>emissions_slope_medium <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">70</span>, <span class="dv">90</span>)</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a>emissions_slope_fast <span class="ot">&lt;-</span> <span class="fu">filterSpeed</span>(emissions_slope, <span class="dv">100</span>, <span class="dv">120</span>)</span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a>slopeEmission <span class="ot">&lt;-</span> <span class="cf">function</span>(slope_data){</span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a>  slope_data <span class="sc">|&gt;</span> </span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Speed_kmh, Gradient) <span class="sc">|&gt;</span></span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_increase_perc =</span> <span class="fu">mean</span>(increase_perc))</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a>emissions_slope_slow <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_slow)</span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a>emissions_slope_medium <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_medium)</span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>emissions_slope_fast <span class="ot">&lt;-</span> <span class="fu">slopeEmission</span>(emissions_slope_fast)</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all into one dataframe</span></span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a>emissions_slope <span class="ot">&lt;-</span> emissions_slope_slow <span class="sc">|&gt;</span></span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_slope_medium, emissions_slope_fast) <span class="sc">|&gt;</span></span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Vehicle <span class="sc">!=</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Vehicle))</span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extrapolate emission values depending on slope and speed}</span></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>filterSlope <span class="ot">&lt;-</span> <span class="cf">function</span>(emission_data, speed_value){</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a>  emission_data <span class="sc">|&gt;</span></span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Speed_kmh <span class="sc">==</span> speed_value)</span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a><span class="co"># run the function for each speed</span></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>slope_50kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">50</span>)</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a>slope_60kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">60</span>)</span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a>slope_70kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">70</span>)</span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a>slope_80kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">80</span>)</span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>slope_90kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">90</span>)</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a>slope_100kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">100</span>)</span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>slope_120kmh <span class="ot">&lt;-</span> <span class="fu">filterSlope</span>(emissions_slope, <span class="dv">120</span>)</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>lm_slope50 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_50kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_50kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a>lm_slope60 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_60kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_60kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a>lm_slope70 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_70kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_70kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a>lm_slope80 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_80kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_80kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a>lm_slope90 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_90kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_90kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a>lm_slope100 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_100kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_100kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a>lm_slope120 <span class="ot">&lt;-</span> <span class="fu">lm</span>(slope_120kmh<span class="sc">$</span>Gradient <span class="sc">~</span> slope_120kmh<span class="sc">$</span>mean_increase_perc)</span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame with coefficients for each speed level</span></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a>extrapolation_slope_emissions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">speed_kmh =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">120</span>, <span class="dv">130</span>,</span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a>                                                          <span class="dv">140</span>, <span class="dv">150</span>, <span class="dv">190</span>),</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">intercept_q =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, </span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope50<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope60<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope70<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope80<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope90<span class="sc">$</span>coefficients[<span class="dv">1</span>],lm_slope100<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a>                                                            (lm_slope100<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>                                                               lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>])<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], </span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a>                                                            lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">1</span>]),</span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">slope_m =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope50<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope60<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope70<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope80<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope90<span class="sc">$</span>coefficients[<span class="dv">2</span>],lm_slope100<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a>                                                        (lm_slope100<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="sc">+</span> lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>])<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>], lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a>                                                        lm_slope120<span class="sc">$</span>coefficients[<span class="dv">2</span>]))</span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a><span class="co"># round speed values to the nearest 10 to join with extrapolation</span></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed_kmh_round =</span> <span class="fu">round</span>(speed_kmh, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a><span class="co"># join the extrapolation of the emission values with the posmo car data</span></span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(extrapolation_slope_emissions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"speed_kmh_round"</span> <span class="ot">=</span> <span class="st">"speed_kmh"</span>))</span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calculate car emission values depending on slope and speed}</span></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the increase in emission for each data point</span></span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(slope_percent <span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emission_increase_perc =</span> slope_m <span class="sc">*</span> slope_percent <span class="sc">+</span> intercept_q) <span class="sc">|&gt;</span></span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(emission_increase_perc <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a><span class="co"># count the number of observations per user</span></span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a>observations_user <span class="ot">&lt;-</span> posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(user_id)</span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase <span class="ot">&lt;-</span> posmo_car<span class="sc">|&gt;</span></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span> </span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_increase_perc =</span> <span class="fu">sum</span>(emission_increase_perc)) <span class="sc">|&gt;</span></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of observations to the data frame with the slope emissions</span></span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase<span class="sc">$</span>observations <span class="ot">&lt;-</span> observations_user<span class="sc">$</span>n</span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a><span class="co"># get the mean increase for each person's car emission when considering the slope</span></span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a>posmo_slope_car_increase <span class="ot">&lt;-</span> posmo_slope_car_increase<span class="sc">|&gt;</span></span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">|&gt;</span> </span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_increase_perc =</span> sum_increase_perc<span class="sc">/</span>observations) <span class="sc">|&gt;</span> </span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a><span class="co"># join the car emissions with the increase of emission because of slope</span></span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a>posmo_car_emissions <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span> </span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_slope_car_increase, <span class="at">by =</span> <span class="st">"user_id"</span>)</span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>emissions_car_slope <span class="ot">&lt;-</span> posmo_car_emissions <span class="sc">|&gt;</span></span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">co2_emissions_g_per_w_slope =</span> co2_emissions_g_per_w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> mean_increase_perc<span class="sc">/</span><span class="dv">100</span>))</span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>The analysis of the weekly emissions of each user shows that for all free users the car and the train provide the highest emissions. Transportation means such as bus, tram, bike or e-bikes produce only small amounts of emissions. If you assess the distances which were travelled with each transport mean (in discussion)</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a>To assess the influence of increasing complexity for the emission values we focused our analysis solely on car emissions. When comparing the emissions calculated with the simple approach and the emissions calculated with the speed approach it is evident that the speed approach resulted in lower emission values for all users.</span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a>When also including the emissions calculated using the slope and the resulting increase in carbon emissions the emission values for the speed and the slope approach are quite similar. For User 2 and 3 the emissions are higher with the slope approach than for the speed approach (maybe more hilly??)</span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>Figure ?? shows the uncertainty which arises when calculating emission values for different transportation modes. The ranges of emission values are especially high for cars as well as buses which is visible in the increased length of the boxes which indicate the range of the possible emissions. User 1 thereby seems to use the car more often whereas user to seems to prefer taking the bus.</span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a>The calculated emissions from Posmo and our own calculated emission vary a lot. Especially the calculated car and the train emissions show huge differences. For the car emissions Posmo calculates values which are higher than our values. Even the highest emission values we found in the literature is still rather small compared to the Posmo emissions. In contrast, the train emissions calculated by Posmo are a lot smaller than our own emission values.</span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a>We determined the weekly emissions of the Posmo and our own calculations. Thereby the emissions calculated with Posmo provide much higher values than our weekly emissions calculated with the slope approach. </span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simple scenario</span></span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot weekly emissions for simple approach, output = TRUE}</span></span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a>emissions_bar_simple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"User"</span>, </span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>),</span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport mode"</span>) <span class="sc">+</span></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Car emissions calcualted based on distance"</span>)<span class="sc">+</span></span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weeky Emissions per Transportation Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">48000</span>)<span class="sc">+</span></span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-seventhFigure</span></span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission based on distances per user normalized over 7 days for different transport modes.</span></span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a>emissions_bar_simple</span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a>*leider nicht sehr viel aussagend, evtl. emissionen für nur einen weg darstellen und dafür etw. genauer analysieren*</span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot weekly emissions for simple approach on map, output = TRUE}</span></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a>emissions_plot_simple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="fu">aes</span>(<span class="at">alpha =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo_traveldistance, <span class="fu">aes</span>(<span class="at">color =</span> co2_emissions_g_per_w))<span class="sc">+</span></span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Emissions per Transport Mode and User"</span>,</span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), <span class="at">type =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-eigthFigure</span></span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spatial reference for CO~2~ emission based on distances per user normalized over 7 days for all transport modes.</span></span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a>emissions_plot_simple</span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a><span class="fu">## Speed scenario</span></span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a>*könnte man rausnehmen, hat unten schon plot mit genau der selben info, einfach noch zusammen mit simple scenario.. aber ansonsten redundant*</span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare data to enable comparison with Posmo emission data}</span></span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the simple emission values to only "Car" values</span></span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a>emissions_car_simple <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span> </span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>)</span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column transport mode to the calculated car emissions using speed information as well</span></span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a>emissions_car_speed <span class="ot">&lt;-</span> emissions_car_speed <span class="sc">|&gt;</span></span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="st">"Car"</span>)</span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a>emissions_new <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span></span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the 'old' emission values for car</span></span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace these values with the new car emissions calculated based on speed</span></span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_car_speed)</span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a>*restliche tranport modes darstellen??*</span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot average weekly emission, output = TRUE}</span></span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a><span class="co"># create the bar chart</span></span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a>emissions_plot_speed_car <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_new, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, </span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on speed"</span>) <span class="sc">+</span></span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weeky Emissions per Transportation Mode &amp; User"</span>)<span class="sc">+</span></span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">45000</span>)<span class="sc">+</span></span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-twelthFigure</span></span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Comparison between CO~2~ emission of all transports mode with mode car calculated using a simple distance-based scenario (left) and a scenario based on driving speed (right).</span></span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a>emissions_plot_speed_car</span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a><span class="fu">## Slope scenario</span></span>
<span id="cb35-705"><a href="#cb35-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-706"><a href="#cb35-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add car emissions calculated using slope to emission data and create bar chart, output = TRUE}</span></span>
<span id="cb35-707"><a href="#cb35-707" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column transport mode to the calculated car emissions using speed information as well</span></span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a>emissions_car_slope <span class="ot">&lt;-</span> emissions_car_slope <span class="sc">|&gt;</span></span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transport_mode =</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(user_id, co2_emissions_g_per_w_slope, transport_mode)) <span class="sc">|&gt;</span></span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">co2_emissions_g_per_w =</span> co2_emissions_g_per_w_slope)</span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a>emissions_new_slope <span class="ot">&lt;-</span> emissions <span class="sc">|&gt;</span></span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the 'old' emission values for car</span></span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">!=</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace these values with the new car emissions calculated based on speed</span></span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(emissions_car_slope)</span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a><span class="co"># create the bar chart</span></span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a>emissions_plot_slope_car <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_new_slope, </span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x =</span> user_id, </span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> co2_emissions_g_per_w, </span>
<span id="cb35-724"><a href="#cb35-724" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">fill =</span> transport_mode)) <span class="sc">+</span></span>
<span id="cb35-725"><a href="#cb35-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on slope"</span>) <span class="sc">+</span></span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weekly Emissions per Transport Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">48000</span>)<span class="sc">+</span></span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-seventeenthFigure</span></span>
<span id="cb35-738"><a href="#cb35-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission values for all transportat modes per user and week with car emissions calculated based on slope and speed.</span></span>
<span id="cb35-739"><a href="#cb35-739" aria-hidden="true" tabindex="-1"></a>emissions_plot_slope_car</span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot locations with emission increase due to slope, output = TRUE}</span></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-thirteenthFigure</span></span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Spatial reference of increase in car CO~2~ emission due to slope. For better visibility, increase values are limited to values between 0.5 and 10%.</span></span>
<span id="cb35-745"><a href="#cb35-745" aria-hidden="true" tabindex="-1"></a>posmo_car <span class="sc">|&gt;</span> </span>
<span id="cb35-746"><a href="#cb35-746" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter increase values between 0.5 and 10%</span></span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(emission_increase_perc <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> emission_increase_perc <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> emission_increase_perc))<span class="sc">+</span></span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CH_cantons, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Increase in emission due to slope"</span>,</span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"emission increase [%]"</span>), <span class="at">type =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-758"><a href="#cb35-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb35-759"><a href="#cb35-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison of all three scenarios</span></span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot grouped bar chart for all car emission scenarios, output = TRUE}</span></span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a>emissions_car_simple<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"simple"</span></span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a>emissions_car_speed<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"speed"</span></span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a>emissions_car_slope<span class="sc">$</span>scenario <span class="ot">&lt;-</span> <span class="st">"slope"</span></span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>user_id, emissions_car_slope<span class="sc">$</span>user_id,</span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a>                                                      emissions_car_speed<span class="sc">$</span>user_id),</span>
<span id="cb35-770"><a href="#cb35-770" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">co2_emissions_g_per_w =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>co2_emissions_g_per_w,</span>
<span id="cb35-771"><a href="#cb35-771" aria-hidden="true" tabindex="-1"></a>                                                                    emissions_car_speed<span class="sc">$</span>co2_emissions_g_per_w,</span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a>                                                                    emissions_car_slope<span class="sc">$</span>co2_emissions_g_per_w),</span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">scenario =</span> <span class="fu">c</span>(emissions_car_simple<span class="sc">$</span>scenario,emissions_car_speed<span class="sc">$</span>scenario, </span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a>                                                       emissions_car_slope<span class="sc">$</span>scenario))</span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios_bar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(emissions_car_all_scenarios, <span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emissions_g_per_w, <span class="at">fill =</span> scenario)) <span class="sc">+</span> </span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb35-779"><a href="#cb35-779" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>),</span>
<span id="cb35-780"><a href="#cb35-780" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Approach"</span>,</span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated using different approaches"</span>) <span class="sc">+</span></span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Overall Car Emissions for All Approaches"</span>) <span class="sc">+</span></span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(co2_emissions_g_per_w, <span class="dv">1</span>)), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">25000</span>)<span class="sc">+</span></span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-thirteenthFigure</span></span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ emission values for all emission scenarios of car emissions per user and week.</span></span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a>emissions_car_all_scenarios_bar</span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison Posmo emission calculations and our calculations</span></span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calculate daily emissions}</span></span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to get the daily emissions</span></span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a>dailyEmission <span class="ot">&lt;-</span> <span class="cf">function</span>(posmo_data, constants){</span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure Date is provided as date and not as datetime</span></span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>  posmo_data<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(posmo_data<span class="sc">$</span>datetime)</span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>  daily_distance <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(distance_km <span class="sc">~</span> user_id <span class="sc">+</span> day <span class="sc">+</span> transport_mode, posmo_data, <span class="at">FUN =</span> sum)</span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a>  daily_emission <span class="ot">&lt;-</span> daily_distance <span class="sc">|&gt;</span></span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(constants, <span class="at">by =</span> <span class="st">"transport_mode"</span>)</span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a>  daily_emission <span class="ot">&lt;-</span> daily_emission <span class="sc">|&gt;</span></span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_emission_kg =</span> distance_km <span class="sc">*</span> avg <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb35-809"><a href="#cb35-809" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_emission_kg =</span> distance_km <span class="sc">*</span> min <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb35-810"><a href="#cb35-810" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_emission_kg =</span> distance_km <span class="sc">*</span> max <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb35-811"><a href="#cb35-811" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-812"><a href="#cb35-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(daily_emission)</span>
<span id="cb35-813"><a href="#cb35-813" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-814"><a href="#cb35-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-815"><a href="#cb35-815" aria-hidden="true" tabindex="-1"></a>daily_emission <span class="ot">&lt;-</span> <span class="fu">dailyEmission</span>(posmo, constants_emission)</span>
<span id="cb35-816"><a href="#cb35-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-817"><a href="#cb35-817" aria-hidden="true" tabindex="-1"></a>emission_avg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(avg_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb35-818"><a href="#cb35-818" aria-hidden="true" tabindex="-1"></a>emission_min <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(min_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb35-819"><a href="#cb35-819" aria-hidden="true" tabindex="-1"></a>emission_max <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(max_emission_kg <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, daily_emission, sum)</span>
<span id="cb35-820"><a href="#cb35-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-821"><a href="#cb35-821" aria-hidden="true" tabindex="-1"></a>emission_CH_mode <span class="ot">&lt;-</span> <span class="fu">left_join</span>(emission_avg, emission_min, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-822"><a href="#cb35-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(emission_max, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>))</span>
<span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read in emission values from Posmo, message = FALSE}</span></span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a>posmo_emission_1 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Posmo_1.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_id =</span> <span class="st">"1af6fc8e-273d-4889-894b-5dadadd70a01"</span>,</span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">dmy</span>(Date)</span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a>posmo_emission_2 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/Emission_Posmo_2.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_id =</span> <span class="st">"6e119464-37a3-4d4e-9eaf-ef1b7e137b60"</span>,</span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">dmy</span>(Date)</span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a>posmo_emission <span class="ot">&lt;-</span> <span class="fu">rbind</span>(posmo_emission_1, posmo_emission_2)</span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a>emission_posmo_mode <span class="ot">&lt;-</span> posmo_emission <span class="sc">|&gt;</span></span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>(transport_mode, emission, <span class="sc">-</span>user_id, <span class="sc">-</span>Date, <span class="sc">-</span>Airplane, <span class="sc">-</span>Notes, <span class="sc">-</span>Sum_all, <span class="sc">-</span>Sum_CH) <span class="sc">|&gt;</span></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origin =</span> <span class="st">"posmo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(user_id, Date, transport_mode, emission, origin) <span class="sc">|&gt;</span></span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate</span>(emission <span class="sc">~</span> user_id <span class="sc">+</span> transport_mode, sum)</span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>emission_cal_posmo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(emission_posmo_mode, emission_CH_mode, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>))</span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, output = TRUE}</span></span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-eighteenthFigure</span></span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: CO~2~ Emissions of Different Transportation Modes.</span></span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> emission_cal_posmo)<span class="sc">+</span></span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">ymin =</span> min_emission_kg, <span class="at">ymax =</span> max_emission_kg, <span class="at">color =</span> user_id), </span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">ymin =</span> avg_emission_kg<span class="fl">-0.5</span>, <span class="at">ymax =</span> avg_emission_kg<span class="fl">+0.5</span>, <span class="at">color =</span> user_id),</span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>), </span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"User 1"</span>, <span class="st">"User 2"</span>),</span>
<span id="cb35-859"><a href="#cb35-859" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Users"</span>)) <span class="sc">+</span></span>
<span id="cb35-860"><a href="#cb35-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> transport_mode, <span class="at">y =</span> emission, <span class="at">color =</span> user_id),</span>
<span id="cb35-861"><a href="#cb35-861" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb35-862"><a href="#cb35-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb35-863"><a href="#cb35-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Locations with acceleration"</span>,</span>
<span id="cb35-864"><a href="#cb35-864" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb35-865"><a href="#cb35-865" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Transport Mode"</span>,</span>
<span id="cb35-866"><a href="#cb35-866" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>] <span class="sc">~</span> <span class="st">"Emission [g/km]"</span>))</span>
<span id="cb35-867"><a href="#cb35-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-868"><a href="#cb35-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a>userid <span class="ot">&lt;-</span> <span class="fu">unique</span>(posmo_emission<span class="sc">$</span>user_id) </span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a><span class="co"># make an empty data frame with the number of days per users</span></span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a>days_per_user <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">user_id =</span> userid)</span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to append</span></span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-881"><a href="#cb35-881" aria-hidden="true" tabindex="-1"></a><span class="co"># use the created function</span></span>
<span id="cb35-882"><a href="#cb35-882" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> userid){</span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">=</span> <span class="fu">get_days</span>(i, posmo)</span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a>  week <span class="ot">=</span> day<span class="sc">/</span><span class="dv">7</span></span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a>  num_weeks <span class="ot">&lt;-</span> <span class="fu">append</span>(num_weeks, week)</span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of days and weeks rounded to 3 digits to the user_id</span></span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a>days_per_user<span class="sc">$</span>weeks <span class="ot">&lt;-</span> <span class="fu">round</span>(num_weeks, <span class="dv">3</span>)</span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-897"><a href="#cb35-897" aria-hidden="true" tabindex="-1"></a>posmo_emission_week <span class="ot">&lt;-</span> emission_posmo_mode <span class="sc">|&gt;</span></span>
<span id="cb35-898"><a href="#cb35-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(transport_mode <span class="sc">==</span> <span class="st">"Car"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posmo_days_per_user, <span class="at">by =</span> <span class="st">"user_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_weekly =</span> emission<span class="sc">/</span>weeks</span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(emissions_car_slope, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"user_id"</span>, <span class="st">"transport_mode"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">co2_emission_kg_per_w =</span> co2_emissions_g_per_w <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-908"><a href="#cb35-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-909"><a href="#cb35-909" aria-hidden="true" tabindex="-1"></a>*noch nicht gut, nicht wirklich schön oder viel aussagend; gibt es bei slope calculation auch eine range oder haben wir da nur jeweils einen wert berechnet??*</span>
<span id="cb35-910"><a href="#cb35-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-911"><a href="#cb35-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, output = TRUE}</span></span>
<span id="cb35-912"><a href="#cb35-912" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(posmo_emission_week) <span class="sc">+</span></span>
<span id="cb35-913"><a href="#cb35-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> emissions_weekly), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb35-914"><a href="#cb35-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_id, <span class="at">y =</span> co2_emission_kg_per_w), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="sc">-</span><span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb35-915"><a href="#cb35-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Users"</span>, </span>
<span id="cb35-916"><a href="#cb35-916" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="st">"CO"</span>[<span class="st">"2"</span>]<span class="sc">~</span> <span class="st">"Emissions [g/week]"</span>), </span>
<span id="cb35-917"><a href="#cb35-917" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Car emissions calculated based on slope"</span>) <span class="sc">+</span></span>
<span id="cb35-918"><a href="#cb35-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Weekly Emissions per Transport Mode &amp; User"</span>) <span class="sc">+</span></span>
<span id="cb35-919"><a href="#cb35-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb35-920"><a href="#cb35-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb35-921"><a href="#cb35-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-922"><a href="#cb35-922" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb35-923"><a href="#cb35-923" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb35-924"><a href="#cb35-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-925"><a href="#cb35-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-926"><a href="#cb35-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-927"><a href="#cb35-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-928"><a href="#cb35-928" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb35-929"><a href="#cb35-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-930"><a href="#cb35-930" aria-hidden="true" tabindex="-1"></a>*vlt gibt posmo infos dazu wie emissionen berechet werden; vergleich mit eigenen annahmen.*</span>
<span id="cb35-931"><a href="#cb35-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-932"><a href="#cb35-932" aria-hidden="true" tabindex="-1"></a>Posmo pursues a more restrictive approach when calculating the emissions for trains. These differences could be explained by different assumptions in capacity utilization or the  power unit of the train. </span>
<span id="cb35-933"><a href="#cb35-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-934"><a href="#cb35-934" aria-hidden="true" tabindex="-1"></a>For the car emission calculations our calculations were more optimistic than the ones from Posmo. An explanation could be that our values refer to the standards of new cars registered in the last few years. These may have higher requirements to be admitted and therefore do not correspond to the average emissions. </span>
<span id="cb35-935"><a href="#cb35-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-936"><a href="#cb35-936" aria-hidden="true" tabindex="-1"></a>*evtl wäre vorher mal noch eine abbildung gut wo wir sagen was die zurückgelegten distanzen sind pro verkehrsmittel um etw. relativieren zu können*</span>
<span id="cb35-937"><a href="#cb35-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-938"><a href="#cb35-938" aria-hidden="true" tabindex="-1"></a><span class="fu">## Limitations</span></span>
<span id="cb35-939"><a href="#cb35-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-940"><a href="#cb35-940" aria-hidden="true" tabindex="-1"></a>Our analysis was prone to several limitations. These ranged from inaccuracies in the data to limitations in our methods. </span>
<span id="cb35-941"><a href="#cb35-941" aria-hidden="true" tabindex="-1"></a>Although we worked with only validated data from the Posmo app, there were inaccuracies present. For example, sometimes speed values were exceptionally high or there was a time lag of 0 between two data points but they were at different locations. Due to theses inaccuracies we excluded all the outliers which led to a reduced amount of data and assumptions we had to make. Another limitations concerning our data was that we only had data sets of three different users which may have not represented the grand public well.</span>
<span id="cb35-942"><a href="#cb35-942" aria-hidden="true" tabindex="-1"></a>Further, we used very simplified approaches to calculate the emissions. We considered various sources for the emission constants in the first and most simple approach, however there are for sure many more sources stating different values. For the speed approach we also used a very simplified method with using one source and extrapolation its observed values. Here, we do not consider anything about car size, fuel type, and so on. Pretty much the same goes for the slope scenario. While the height values extracted from the DHM were quite accurate, the rest of this approach very likely was not. We used values from only one source (Xu et al., 2020) to extrapolated the increase in emission based on the inclination. The sources used two  vehicle types with different sizes whereas we averaged for both types. As we only used positive slopes which cause an increase in emission, our calculated increase values were possible to high. Overall, there are many assumptions that we made an also many times that we had to average over certain car types, environmental factors, and so on. </span>
<span id="cb35-943"><a href="#cb35-943" aria-hidden="true" tabindex="-1"></a>Furthermore, we also did not include the occupancy rate of any public transportation vehicle or the cars as we simple did not have easily accessible data about that. The same goes for the influence of the fuel type. We do not know what kind of cars our three users drive which is why we could not consider fuel type of cars in our analysis either.</span>
<span id="cb35-944"><a href="#cb35-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-945"><a href="#cb35-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-946"><a href="#cb35-946" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outlook</span></span>
<span id="cb35-947"><a href="#cb35-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-948"><a href="#cb35-948" aria-hidden="true" tabindex="-1"></a>There are many factors that could have been included in our analysis as stated above. One thing that we did not include and would suggest to do as a next step is including the emission increase due to acceleration. Acceleration also has an influence on the emissions of cars and emissions change significantly with changing speed (Dong et al., 2022). In the figure below, we can see where there are locations with acceleration and where there are locations with deceleration.</span>
<span id="cb35-949"><a href="#cb35-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-950"><a href="#cb35-950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot acceleration and deceleration}</span></span>
<span id="cb35-951"><a href="#cb35-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lastFigure</span></span>
<span id="cb35-952"><a href="#cb35-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Posmo trajectories with acceleration and deceleration locations.</span></span>
<span id="cb35-953"><a href="#cb35-953" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-954"><a href="#cb35-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> posmo, <span class="fu">aes</span>(<span class="at">color =</span> acceleration))<span class="sc">+</span></span>
<span id="cb35-955"><a href="#cb35-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Locations with acceleration"</span>,</span>
<span id="cb35-956"><a href="#cb35-956" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Movement trajectories in Switzerland"</span>,</span>
<span id="cb35-957"><a href="#cb35-957" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"E"</span>,</span>
<span id="cb35-958"><a href="#cb35-958" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"N"</span>)<span class="sc">+</span></span>
<span id="cb35-959"><a href="#cb35-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Acceleration"</span>))<span class="sc">+</span></span>
<span id="cb35-960"><a href="#cb35-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="fu">st_crs</span>(<span class="dv">2056</span>))<span class="sc">+</span></span>
<span id="cb35-961"><a href="#cb35-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb35-962"><a href="#cb35-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-963"><a href="#cb35-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-964"><a href="#cb35-964" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sources</span></span>
<span id="cb35-965"><a href="#cb35-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-966"><a href="#cb35-966" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb35-967"><a href="#cb35-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-968"><a href="#cb35-968" aria-hidden="true" tabindex="-1"></a>Bundesamt für Landestopographie swisstopo (no date a): DHM25. URL: <span class="ot">&lt;https://www.swisstopo.admin.ch/de/geodata/height/dhm25.html#download&gt;</span> (as at: no date) (last access: 05.06.2023).</span>
<span id="cb35-969"><a href="#cb35-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-970"><a href="#cb35-970" aria-hidden="true" tabindex="-1"></a>Bundesamt für Landestopographie swisstopo (no date b): swissBOUNDARIES3D URL: &lt;https://www.swisstopo.admin.ch/de/geodata/landscape/boundaries3d.html &gt; (as at: no date) (last access: 05.06.2023).</span>
<span id="cb35-971"><a href="#cb35-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-972"><a href="#cb35-972" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Car emissions</span></span>
<span id="cb35-973"><a href="#cb35-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-974"><a href="#cb35-974" aria-hidden="true" tabindex="-1"></a>Bundesamt für Statistik BFS (2023): Fahrzeuge und Transportmittelbestände des Güterverkehrs. URL: <span class="ot">&lt;https://www.bfs.admin.ch/bfs/de/home/statistiken/raum-umwelt/umweltindikatoren/alle-indikatoren/reaktionen-der-gesellschaft/co2-ausstoss-personenwagen.assetdetail.23908017.html&gt;</span> (as at: 05.04.2023) (last access: 05.06.2023).</span>
<span id="cb35-975"><a href="#cb35-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-976"><a href="#cb35-976" aria-hidden="true" tabindex="-1"></a>Deutsche Physikalische Gesellschaft (2022): CO2-Emissionen beim Reisen. URL: <span class="ot">&lt;https://www.dpg-physik.de/vereinigungen/fachuebergreifend/ak/akjdpg/wir/arbeitsteams/nachhaltigkeit/nachgeforscht/co2-emissionen-beim-reisen&gt;</span> (as at: 01.01.2022) (last access: 05.06.2023).</span>
<span id="cb35-977"><a href="#cb35-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-978"><a href="#cb35-978" aria-hidden="true" tabindex="-1"></a>Europäisches Parlament (2018): Senkung der Emissionen: Neue CO₂-Ziele für Pkw und leichte Nutzfahrzeug. URL: <span class="ot">&lt;https://www.europarl.europa.eu/news/de/headlines/society/20180920STO14027/senkung-der-emissionen-neue-co2-ziele-fur-pkw-und-leichte-nutzfahrzeuge&gt;</span> (as at: 15.02.2023) (last access: 05.06.2023).</span>
<span id="cb35-979"><a href="#cb35-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-980"><a href="#cb35-980" aria-hidden="true" tabindex="-1"></a>Umweltbundesamt (2014): E-Rad macht mobil. Potenziale von Pedelecs und deren Umweltwirkung. URL: <span class="ot">&lt;https://www.umweltbundesamt.de/sites/default/files/medien/378/publikationen/hgp_e-rad_macht_mobil_-_pelelecs_4.pdf&gt;</span> (as at: 01.08.2014) (last access: 05.06.2023).</span>
<span id="cb35-981"><a href="#cb35-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-982"><a href="#cb35-982" aria-hidden="true" tabindex="-1"></a>Umweltbundesamt (2021): Vergleich der durchschnittlichen Emissionen einzelner Verkehrsmittel Personenverkehr in Deutschland 2021. URL: <span class="ot">&lt;https://www.umweltbundesamt.de/sites/default/files/medien/366/bilder/dateien/uba_emissionstabelle_personenverkehr_2021_0.pdf&gt;</span> (as at: 01.12.2022) (last access: 05.06.2023).</span>
<span id="cb35-983"><a href="#cb35-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-984"><a href="#cb35-984" aria-hidden="true" tabindex="-1"></a>Umweltbundesamt (no date): Niedrigere Geschwindigkeit spart Energie und schont die Umwelt. URL: <span class="ot">&lt;https://www.umweltbundesamt.at/umweltthemen/mobilitaet/mobilitaetsdaten/tempo&gt;</span> (as at: no date) (last access: 21.06.2023).</span>
<span id="cb35-985"><a href="#cb35-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-986"><a href="#cb35-986" aria-hidden="true" tabindex="-1"></a>umweltnetz-schweiz (2019): Klimabaustein: Bus oder Bahn? URL: <span class="ot">&lt;https://www.umweltnetz-schweiz.ch/themen/klima/3101-klimabaustein-bus-oder-bahn.html#:~:text=Autobusse%20dagegen%20verursachen%20rund%20145,rund%2037%20g%2FPkm%20ausstossen&gt;</span> (as at: 18.01.2019) (last access: 05.06.2023).</span>
<span id="cb35-987"><a href="#cb35-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-988"><a href="#cb35-988" aria-hidden="true" tabindex="-1"></a>World Wide Fund for Nature (2020): Autoverkehr und Elektromobilität. URL: <span class="ot">&lt;https://www.wwf.ch/de/unsere-ziele/autoverkehr-und-elektromobilitaet&gt;</span> (as at: no date) (last access: 05.06.2023).</span>
<span id="cb35-989"><a href="#cb35-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-990"><a href="#cb35-990" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Slope threshold</span></span>
<span id="cb35-991"><a href="#cb35-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-992"><a href="#cb35-992" aria-hidden="true" tabindex="-1"></a>Wikipedia (2022): Balmberg. URL: <span class="ot">&lt;https://de.wikipedia.org/wiki/Balmberg&gt;</span> (as at: 02.10.2022) (last access: 28.06.2023).</span>
<span id="cb35-993"><a href="#cb35-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-994"><a href="#cb35-994" aria-hidden="true" tabindex="-1"></a><span class="fu">### Literature</span></span>
<span id="cb35-995"><a href="#cb35-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-996"><a href="#cb35-996" aria-hidden="true" tabindex="-1"></a>**Bundesamt für Statistik BFS, Bundesamt für Raumplanung ARE** (2023): Mikrozensus Mobilität und Verkehr (MZMV).</span>
<span id="cb35-997"><a href="#cb35-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-998"><a href="#cb35-998" aria-hidden="true" tabindex="-1"></a>**Dong, Yaping; Xu, Jinliang; Ni, Jie** (2022): Carbon emission model of vehicles driving at fluctuating speed on highway. In: Environmental Science and Pollution Research, Vol. 30, pp. 18064-18077.</span>
<span id="cb35-999"><a href="#cb35-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1000"><a href="#cb35-1000" aria-hidden="true" tabindex="-1"></a>**Knupfer, G. (Handelszeitung)** (2014): Die SBB fahren im Vergleich im Schneckentempo. URL: <span class="ot">&lt;https://www.handelszeitung.ch/unternehmen/die-sbb-fahren-im-vergleich-im-schneckentempo-660389&gt;</span> (as at: 29.08.2014) (last access: 28.06.2023).</span>
<span id="cb35-1001"><a href="#cb35-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1002"><a href="#cb35-1002" aria-hidden="true" tabindex="-1"></a>**Metcalfe, J.; Boulter &amp; P.** (2022). Effect of speed on greenhouse gas emissions from road transport: a </span>
<span id="cb35-1003"><a href="#cb35-1003" aria-hidden="true" tabindex="-1"></a>review. Report prepared by Emission Impossible Ltd, and EMM Consulting, for Waka Kotahi, </span>
<span id="cb35-1004"><a href="#cb35-1004" aria-hidden="true" tabindex="-1"></a>December, 2022.</span>
<span id="cb35-1005"><a href="#cb35-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1006"><a href="#cb35-1006" aria-hidden="true" tabindex="-1"></a>**Suarez, Jaime; Makridis, Michail; Anesiadou, Aikaterini; Komnos, Dimitrios; Ciuffo, Biagio; Fontaras, Georgios** (2022): Benchmarking the driver acceleration impact on vehicle energy consumption and CO2 emissions. In: Transportation Research Part D, Vol. 107.</span>
<span id="cb35-1007"><a href="#cb35-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1008"><a href="#cb35-1008" aria-hidden="true" tabindex="-1"></a>**Xu, Jinliang; Dong, Yaping &amp; Yan, Menghua** (2020): A Model for Estimating Passenger-Car Carbon Emissions that Accounts for Uphill, Downhill and Flat Roads. In: Sustainability, Vol. 12, No. 2028.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>